(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1335:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1),a=n.n(o),c=n(62),r=Object.assign;var i=function(e){return a.a.createElement(c.a,r({width:"150",height:"120",viewBox:"0 0 150 120"},e),a.a.createElement("g",{fill:"none",fillRule:"evenodd"},a.a.createElement("path",{fill:"#EBEEF5",d:"M102 30.998A2.996 2.996 0 0098.998 28H50.002A2.996 2.996 0 0047 30.998v58.147l.193-.125c1.453-.94 3.473-.94 4.927 0l2.537 1.64 2.536-1.64c1.453-.94 3.473-.94 4.927 0l2.537 1.64 2.536-1.64c1.453-.94 3.473-.94 4.927 0l2.537 1.64 2.536-1.64c1.453-.94 3.473-.94 4.927 0l2.537 1.64 2.536-1.64c1.453-.94 3.473-.94 4.927 0l2.537 1.64 2.536-1.64c1.413-.913 3.363-.94 4.807-.075V30.998zm-1.508 60.542c-.464-.3-1.21-.298-1.67 0l-4.165 2.692-4.165-2.692c-.464-.3-1.21-.298-1.67 0l-4.165 2.692-4.165-2.692c-.464-.3-1.21-.298-1.67 0l-4.165 2.692-4.165-2.692c-.464-.3-1.21-.298-1.67 0l-4.165 2.692-4.165-2.692c-.464-.3-1.21-.298-1.67 0l-4.165 2.692-4.165-2.692c-.464-.3-1.21-.298-1.67 0l-4.316 2.79A1.99 1.99 0 0144 93V30.997C44 27.687 46.68 25 50.002 25h48.996A5.996 5.996 0 01105 30.998v62c0 .45-.147.866-.396 1.2l-4.112-2.658z",fillRule:"nonzero"}),a.a.createElement("path",{fill:"#F7F8FA",d:"M55 39c0-.553.44-1 1-1h19c.553 0 1 .44 1 1v19c0 .553-.44 1-1 1H56c-.553 0-1-.44-1-1V39zm25 .5c0-.828.675-1.5 1.498-1.5h11.004c.827 0 1.498.666 1.498 1.5 0 .828-.675 1.5-1.498 1.5H81.498A1.495 1.495 0 0180 39.5zm0 9c0-.828.675-1.5 1.498-1.5h11.004c.827 0 1.498.666 1.498 1.5 0 .828-.675 1.5-1.498 1.5H81.498A1.495 1.495 0 0180 48.5zm0 9c0-.828.675-1.5 1.498-1.5h11.004c.827 0 1.498.666 1.498 1.5 0 .828-.675 1.5-1.498 1.5H81.498A1.495 1.495 0 0180 57.5zm-25 9c0-.828.677-1.5 1.505-1.5h35.99a1.5 1.5 0 110 3h-35.99A1.5 1.5 0 0155 66.5zm0 9c0-.828.665-1.5 1.505-1.5h24.99a1.5 1.5 0 110 3h-24.99A1.5 1.5 0 0155 75.5z"})))}},1341:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return f}));var o=n(27),a=n(0),c=n(5),r=["children"],i=function(e){var t=e.children,n=Object(o.default)(e,r);return Object(a.b)(c.Flex,Object.assign(Object.assign({alignItems:"center",justifyContent:"center",flex:1,height:"100%"},n),{},{children:Object(a.b)(c.Text,{textAlign:"center",color:"GBL05A",children:t})}))},s=n(1),l=n.n(s),m=n(62);Object.assign;Object.assign;n(1335),Object.assign;var u=Object.assign;var d=function(e){return l.a.createElement(m.a,u({width:"150",height:"120",viewBox:"0 0 150 120"},e),l.a.createElement("g",{fill:"none",fillRule:"evenodd"},l.a.createElement("path",{fill:"#EBEEF5",d:"M106.807 78h8.19A3.004 3.004 0 00118 74.998V34.002A3 3 0 00114.997 31H61.003A3.004 3.004 0 0058 34.002V36h-3v-1.998A6.004 6.004 0 0161.003 28h53.994A6 6 0 01121 34.002v40.996A6.004 6.004 0 01114.997 81h-5.372l-.375 6.004c-.138 2.207-1.514 2.732-3.074 1.172L99 81h-5v-3h6.243l6.178 6.178.388-6.178zM44.824 95.176c-1.56 1.56-2.936 1.035-3.074-1.172L41.312 87H37a6 6 0 01-6-6.006V45.006A6.01 6.01 0 0137 39h48a6 6 0 016 6.006v35.988A6.01 6.01 0 0185 87H53l-8.176 8.176zm-.245-3.998L51.755 84H85c1.65 0 3-1.35 3-3.006V45.006A3 3 0 0085 42H37c-1.65 0-3 1.35-3 3.006v35.988A3 3 0 0037 84h7.13l.45 7.178z",fillRule:"nonzero"}),l.a.createElement("path",{fill:"#F7F8FA",d:"M94 49h9.494a1.5 1.5 0 110 3H94v-3zm0 9h9.494a1.5 1.5 0 110 3H94v-3zm-50 6.5c0-.828.68-1.5 1.505-1.5h30.99a1.5 1.5 0 110 3h-30.99A1.5 1.5 0 0144 64.5zm0-14.503c0-.55.453-.997.997-.997h6.006c.55 0 .997.453.997.997v6.006c0 .55-.453.997-.997.997h-6.006c-.55 0-.997-.453-.997-.997v-6.006zM44 73.5c0-.828.68-1.5 1.505-1.5h30.99a1.5 1.5 0 110 3h-30.99A1.5 1.5 0 0144 73.5z"})))},p=Object.assign;var h=function(e){return l.a.createElement(m.a,p({width:"150",height:"120",viewBox:"0 0 150 120"},e),l.a.createElement("path",{fill:"#EBEEF5",d:"M62.85 82.335c-.13-.03-.202-.04-.25-.044-.117 0-.31.05-.87.34-7.092 2.65-7.508 2.79-9.903 3.43-.955.26-1.885.46-2.826.63-1.24.23-2.52-.08-3.35-.83-1.12-1.01-1.16-2.58-.02-3.73l.28-.22s.074-.053.204-.19c.265-.26.54-.63.81-1.102.588-1.05 1.025-2.445 1.224-4.246.145-.8-.374-2.14-1.117-2.833-.23-.216-.696-.727-1.487-1.683-3.62-4.37-6.03-12.332-6.03-18.87C39.5 37.19 53.48 23.5 72.446 23.5c19.842 0 32.947 13.235 32.947 29.466 0 21.157-22.76 36.133-42.028 29.488-.182-.04-.473-.11-.515-.12zm-.068-3.038c.233.014.448.05.717.108l.6.14c17.56 6.102 38.29-7.514 38.29-26.58 0-14.58-11.77-26.465-29.95-26.465-17.32 0-29.95 12.36-29.95 26.466 0 5.885 2.203 13.176 5.333 16.96.716.865 1.102 1.287 1.222 1.4 1.432 1.34 2.34 3.65 2.044 5.404-.246 2.172-.8 3.94-1.585 5.338a8.3 8.3 0 01-1.213 1.68c1.02-.175 1.87-.366 2.75-.598 2.25-.596 2.667-.743 9.4-3.245.95-.47 1.596-.653 2.326-.608zm11.554 9.593a1.5 1.5 0 111.919-2.306c5.242 4.364 12.82 5.41 19.8 2.98l.173-.05c.084-.017.372-.085.433-.1.22-.046.39-.074.59-.086.61-.037 1.14.11 1.87.472 4.83 1.793 5.13 1.9 6.73 2.324.57.15 1.12.276 1.68.38-.22-.318-.46-.7-.68-1.153-.58-1.14-.99-2.51-1.173-4.12-.232-1.39.38-2.75 1.537-3.83.12-.11.43-.44.947-1.05 2.1-2.47 3.356-7.15 3.356-11.61 0-4.7-.62-7.39-2.7-10.094a1.5 1.5 0 012.381-1.828c2.56 3.33 3.318 6.62 3.318 11.925 0 5.11-1.433 10.45-4.066 13.555-.59.693-.98 1.107-1.19 1.304-.49.46-.675.873-.623 1.16.16 1.37.47 2.41.894 3.25.324.647.62 1.013.756 1.13 1.162 1.17.883 2.636-.177 3.54-.78.67-1.91 1-2.948.817-.69-.124-1.373-.28-2.073-.46-1.75-.466-2.05-.57-7.08-2.44l-.156-.068c-.344-.173-.42-.195-.414-.195-.142.03-.33.075-.464.105-7.91 2.728-16.56 1.52-22.627-3.533z"}))},b=Object.assign;var f=function(e){return l.a.createElement(m.a,b({width:"150",height:"120",viewBox:"0 0 150 120"},e),l.a.createElement("path",{fill:"#EBEEF5",d:"M46.76 78.71a1.895 1.895 0 00-1.378 2.092c.13.948.94 1.648 1.904 1.635h55.468a1.882 1.882 0 001.884-1.635c.13-.95-.46-1.846-1.367-2.09a8.61 8.61 0 01-6.4-7.872l-2.473-20.928c-.96-7.872-6.567-14.37-14.178-16.435l-.986-.267-.113-1.014c-.24-2.106-2.01-3.696-4.11-3.696s-3.87 1.59-4.104 3.696l-.114 1.014-.98.267c-7.61 2.063-13.22 8.563-14.18 16.43L53.15 70.84c-.2 3.74-2.79 6.926-6.393 7.87zm50.61-29.155l2.482 20.982c.127 2.562 1.817 4.654 4.19 5.276a4.895 4.895 0 013.568 5.397c-.336 2.446-2.434 4.26-4.876 4.227H47.306a4.883 4.883 0 01-4.896-4.227 4.897 4.897 0 013.58-5.4 5.614 5.614 0 004.17-5.168l2.49-21.093c1.068-8.77 7.135-16.06 15.46-18.7.807-3.11 3.615-5.35 6.9-5.35s6.094 2.24 6.9 5.35c8.325 2.64 14.393 9.93 15.46 18.7zm-16.417 38.91c-.288 3.184-3.007 5.36-5.943 5.36-2.936 0-5.655-2.176-5.943-5.36l-2.988.27c.43 4.82 4.52 8.09 8.93 8.09s8.49-3.27 8.93-8.09l-2.99-.27z"}))};Object.assign;Object.assign;Object.assign},1369:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var o=n(27),a=n(7),c=n.n(a),r=["className","label","tabIndex"];function i(e){return"Enter"===e.key||" "===e.key||"Enter"===e.code||"Space"===e.code||13===e.keyCode||32===e.keyCode}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.className,a=t.label,s=void 0===a?"":a,l=t.tabIndex,m=void 0===l?0:l,u=Object(o.default)(t,r);return Object.assign(Object.assign({role:"button",tabIndex:m,onClick:e,onKeyDown:function(t){i(t)&&e(t)},className:c()("a11y-button",n)},s&&{"aria-label":s}),u)}},1378:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var o,a=n(17),c=n(4),r=n(0),i=n(20),s=n(1),l=n(51),m=n(512),u=n(85),d=n(115),p={comment_img:"comment_img",dynamic_top:"dynamic_top",comment_sticker:"comment_sticker",block_keyword:"block_keyword"},h=(o={},Object(c.a)(o,p.comment_img,"https://pic1.zhimg.com/v2-1b6677f81c2df41f55332474e15bc5a8.png"),Object(c.a)(o,p.dynamic_top,"https://pic1.zhimg.com/v2-e16a265a43592abd5b98fceef02a1614.png"),Object(c.a)(o,p.comment_sticker,"https://pic1.zhimg.com/v2-183a98cd480d24cd3e3246ba7a26303b.png"),Object(c.a)(o,p.block_keyword,"https://pic3.zhimg.com/v2-0ad4e8aa43c3279cc7536f2fb7ac8348.png"),o);t.b=Object(u.a)((function(e){var t=e.show,n=e.setShow,o=e.type,c=e.isLogin,u=Object(s.useState)(""),p=Object(a.a)(u,2),b=p[0],f=p[1],v=Object(s.useState)(!1),C=Object(a.a)(v,2),O=C[0],j=C[1],g=Object(d.b)(),y=Object(i.c)((function(){t&&n(!1)}));return Object(s.useEffect)((function(){!b&&c&&(j(!0),g("/api/v4/unlimited/vip_rights/popup?token="+o).then((function(e){f(e.payload.button.text)})).catch((function(){})).then((function(){j(!1)})))}),[t]),Object(r.b)(l.b,{css:{".Modal-content":{padding:0,marginTop:0}},onClose:y,children:t&&!O&&Object(r.c)(r.a,{children:[Object(r.b)("img",{alt:"",src:h[o],css:{height:"230px",width:"400px",display:"block"}}),Object(r.b)("div",{css:{padding:20},children:Object(r.b)("div",{role:"button",tabIndex:0,css:function(e){return{padding:8,background:"linear-gradient(135deg, ".concat(e.colors.GYL06A," 0.2%, ").concat(e.colors.GYL08A," 100%)"),borderRadius:3,textAlign:"center",fontsize:14,color:e.colors.GYL12A,userSelect:"none","&:hover":{cursor:"pointer"}}},onClick:m.a.show,children:b||"开通会员立即解锁"})})]})})}))},1395:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var o=n(10),a=n(11),c=n(13),r=n(14),i=n(6),s=n(0),l=n(1),m=n.n(l),u=n(2),d=n.n(u),p=n(7),h=n.n(p),b=n(239),f=n(18),v=n(48),C=n(833),O=n(8),j=Object.assign;function g(e){return m.a.createElement(O.a,j(j({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowSwitch24","data-old-api":"Switch"},e),{className:"Zi Zi--Switch"+(e.className?" ".concat(e.className):"")}),m.a.createElement("path",{d:"M18.296 8.592a.75.75 0 101.149-.964l-3.87-4.61a.747.747 0 00-1.057-.092.748.748 0 00-.268.574v17a.75.75 0 001.5 0V5.56l2.546 3.032zM9.75 20.5a.749.749 0 01-.293.595.75.75 0 01-1.097-.056l-3.87-4.613a.75.75 0 111.15-.964l2.61 3.111V3.5a.75.75 0 111.5 0v17z",fillRule:"evenodd",clipRule:"evenodd"}))}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}var R={normal:{text:"默认排序",value:"reverse"},reverse:{text:"时间排序",value:"normal"}},k=function(e){Object(c.a)(n,e);var t=y(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={text:"时间排序",value:"normal"},e.switchType=function(t){var n=e.state.value,o=e.props.onOrderChange,a=R[n],c=a.text,r=a.value;e.setState({text:c,value:r}),o&&o(r,t)},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.state.text,t=this.props,n=t.isConversation,o=t.commentClosed;return t.shouldReverse?!n&&!o&&Object(s.b)(f.c,{preset:"plain",onClick:this.switchType,icon:g,label:"切换为".concat(e)}):null}}]),n}(l.Component);k.propTypes={isConversation:d.a.bool,commentClosed:d.a.bool,onOrderChange:d.a.func,shouldReverse:d.a.bool};var N=n(1276);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}var w=function(e){Object(c.a)(n,e);var t=I(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.commentPattern,n=e.onNavBack;return Object(s.b)("h2",{className:"CommentTopbar-title",children:"bottom"!==t?Object(s.c)(f.c,{className:"CommentTopbar-back",preset:"plain",onClick:n,children:[Object(s.b)(N.a,{text:!0,center:!0})," 返回评论"]}):Object(s.b)("div",{children:"查看对话"})})}}]),n}(l.Component);function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}w.propTypes={commentPattern:d.a.string,onNavBack:d.a.func};var P=function(e){Object(c.a)(n,e);var t=S(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).renderTopBarSwitch=function(){var t=e.props,n=t.isMobile,o=t.status,a=t.isConversation,c=t.commentCount,r=t.onOrderChange,i=t.commentClosed,l=t.shouldReverse;return!n&&Boolean(c&&!i)&&"reviewing"!==o&&Object(s.b)(k,{isConversation:a,onOrderChange:r,commentClosed:i,shouldReverse:l})},e}return Object(a.a)(n,[{key:"renderTitle",value:function(){var e=this.props,t=e.commentCount,n=e.commentClosed,o=e.isConversation,a=e.onNavBack,c=e.targetLink,r=e.isCommentReviewer,i=e.reviewingCounts,m=e.onStatusChange,u=e.status,d=e.commentPattern,p=e.isOrg,C=e.isMobile;return o?Object(s.b)(w,{commentPattern:d,onNavBack:a}):r&&!n?Object(s.c)("div",{className:"CommentTopbar-tabsWrapper",children:[Object(s.c)(b.b,{className:"CommentTopbar-tabs",children:[Object(s.b)(b.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-open",meta:Object(v.formatNumber)(t),children:Object(s.b)(f.c,{className:h()("CommentTopbar-tabButton",{"is-active":"open"===u}),onClick:function(){return m("open")},children:"公开评论"})}),!C&&Object(s.b)(b.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-reviewing",meta:void 0===i?null:Object(v.formatNumber)(i),children:Object(s.b)(f.c,{className:h()("CommentTopbar-tabButton",{"is-active":"reviewing"===u}),onClick:function(){return m("reviewing")},children:"待".concat(p?"审核":"筛选","评论")})})]}),c]}):Object(s.b)(l.Fragment,{children:Object(s.c)("h2",{className:"CommentTopbar-title",children:[t&&!n?"".concat(Object(v.formatNumber)(t)," 条评论"):"还没有评论",c]})})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.onRef,o=e.isMobile;return Object(s.b)(C.a,{className:h()("CommentTopbar",t),onRef:n,header:this.renderTitle(),options:this.renderTopBarSwitch(),showOptions:!o})}}]),n}(l.Component);P.propTypes={commentCount:d.a.oneOfType([d.a.number,d.a.string]),isConversation:d.a.bool,onNavBack:d.a.func,isCommentReviewer:d.a.bool,onStatusChange:d.a.func,onOrderChange:d.a.func,status:d.a.string,reviewingCounts:d.a.oneOfType([d.a.number,d.a.string]),targetLink:d.a.node,commentClosed:d.a.bool,commentPattern:d.a.string,isOrg:d.a.bool,isMobile:d.a.bool,options:d.a.element,shouldReverse:d.a.bool},P.defaultProps={shouldReverse:!0}},1398:function(e,t,n){"use strict";var o=n(0),a=n(2),c=n.n(a),r=n(7),i=n.n(r),s=Array.from(Array(12),(function(e,t){return Object(o.b)("span",{className:"Spinner-blade-12"},t)}));function l(e){var t=e.className,n=e.white,a=e.large;return Object(o.b)("div",{className:i()("Spinner-blade",t,{"Spinner-blade--large":a,"Spinner-blade--white":n}),children:s})}l.propTypes={className:c.a.string,large:c.a.bool,white:c.a.bool};var m=l;t.a=m},1408:function(e,t,n){"use strict";var o=n(17),a=n(0),c=n(1),r=n(79),i=n.n(r),s=n(12),l=n(487),m=Object(s.connect)((function(e){return{hasData:e.emoticons.emoticonGroupList.length>0}}));t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return m(i()((function(t){var r=t.hasData,i=Object(c.useState)(!1),m=Object(o.a)(i,2),u=m[0],d=m[1],p=Object(s.useDispatch)();return Object(c.useEffect)((function(){r?d(!0):p(Object(l.d)()).then((function(e){var t=e.payload.data[0].id;p(Object(l.e)(t)),d(!0)})).catch((function(){d(!0)}))}),[p,r]),(!u||!n)&&Object(a.b)(e,Object.assign({},t))}),e))}}},1423:function(e,t,n){"use strict";function o(e,t,n){var o;return["answer","question"].includes(e)?"question"===e?null==n?void 0:n.censorCommentDescription:null==t||null===(o=t.brand)||void 0===o?void 0:o.censorCommentDescription:""}n.d(t,"a",(function(){return o}))},1428:function(e,t,n){"use strict";var o=n(10),a=n(11),c=n(13),r=n(14),i=n(6),s=n(0),l=n(1),m=n(12),u=n(26),d=n(2),p=n.n(d),h=n(7),b=n.n(h),f=n(492),v=n.n(f),C=n(20),O=n(9),j=n(487),g=n(49),y=n(108),R=n(1378),k=n(17),N=n(348);function I(e){var t,n,o,a,c,r,i,m,u,d=e.className,p=e.emoticonGroupList,h=e.curEmoticonGroupId,f=e.onGroupSelected,v=e.vipEnabled,O=Object(l.useRef)(),j=Object(N.a)(v,p),g=(t=O,n=Object(l.useState)({left:null,x:null}),o=Object(k.a)(n,2),a=o[0],c=o[1],r=Object(l.useState)(!1),i=Object(k.a)(r,2),m=i[0],u=i[1],{onMouseDown:Object(C.c)((function(e){var n;u(!0);var o=null===(n=t.current)||void 0===n?void 0:n.scrollLeft,a=e.clientX;c({left:o,x:a}),e.preventDefault()})),onMouseMove:Object(C.c)((function(e){if(m){var n=e.clientX-a.x;t.current&&(t.current.scrollLeft=a.left-n)}})),onMouseUp:Object(C.c)((function(){m&&u(!1)}))});return Object(s.b)("div",{className:b()("EmoticonsFooter",d),children:Object(s.b)("ul",Object.assign(Object.assign({className:"EmoticonsFooter-items",ref:O},g),{},{children:j.map((function(e){return Object(s.b)("li",{className:b()("EmoticonsFooter-item",{"EmoticonsFooter-item--selected":h===e.id}),onClick:function(){f(e.id)},children:Object(s.b)("img",{alt:"",src:e.iconUrl,className:"EmoticonsFooter-itemIcon"})},e.id)}))}))})}var w=n(1398);function S(e){var t=e.item,n=e.type,o=e.onSelectEmoticon,a=t.title,c=t.staticImageUrl,r=t.dynamicImageUrl,i=function(e){r&&(e.target.src=r)},l=function(e){r&&(e.target.src=c)},m=function(){o(t,n)};return Object(s.c)(O.a,{zaType:"Button",zaText:a,zaEventType:"Click",zaBlock:"vip"===n?"VipEmoticon":"Emoticon",as:"li",className:b()("EmoticonPanel-item",{"EmoticonPanel-item--big":"emoji"!==n}),onClick:m,onKeyPress:function(e){" "===e.key&&m()},tabIndex:0,children:[Object(s.b)("img",{src:c,title:"emoji"===n?a:"",className:b()({"EmoticonPanel-itemImg--small":"emoji"===n,"EmoticonPanel-itemImg--big":"emoji"!==n}),onMouseOver:i,onMouseOut:l,onFocus:i,onBlur:l,alt:a}),"emoji"!==n&&Object(s.b)("span",{className:"EmoticonPanel-itemTitle",children:a})]})}function P(e){var t=e.type,n=e.data,o=void 0===n?[]:n,a=e.onSelectEmoticon;return 0===o.length?Object(s.b)(w.a,{className:"EmoticonPanel-spinner"}):Object(s.b)("ul",{className:"EmoticonPanel",children:o.map((function(e){return Object(s.b)(S,{item:e,type:t,onSelectEmoticon:a},e.id)}))})}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}P.propTypes={type:p.a.string.isRequired,data:p.a.array.isRequired,onSelectEmoticon:p.a.func.isRequired};var B=function(e){Object(c.a)(n,e);var t=E(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).getCurEmoticonGroupPanleData=function(){var t=e.props,n=t.curEmoticonGroupId;return t.emoticonPanelList.filter((function(e){return e.groupId===n}))},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.changeSelectedEmoticonPanel,n=e.curEmoticonPanelId,o=e.className,a=this.getCurEmoticonGroupPanleData();return a.length<=1?null:Object(s.b)("ul",{className:b()("EmoticonPagination",o),children:a.map((function(e){return Object(s.b)("li",{className:b()("EmoticonPagination-bullet",{"EmoticonPagination-bullet--active":e.id===n}),onClick:function(){t(e.id)}},e.id)}))})}}]),n}(l.Component);B.propsTypes={className:p.a.string};var T=Object(m.connect)((function(e){var t=e.emoticons;return{curEmoticonGroupId:t.curEmoticonGroupId,emoticonPanelList:t.emoticonPanelList,curEmoticonPanelId:t.curEmoticonPanelId}}),{changeSelectedEmoticonPanel:j.b})(B),x=n(4),L=n(1269),z=n(28);function A(e){var t=e.show,n=e.onClick,o=Object(C.c)((function(){null==n||n()}));return t&&Object(s.c)(O.a,{zaType:"Button",zaEventType:"Click",zaAction:"OpenUrl",zaBlock:"VipBrand",extra:{link:{url:z.x}},css:function(e){return Object(x.a)({backgroundColor:e.colorMod(e.colors.GYL08A).alpha(.25),color:e.colors.GYL12A,display:"flex",alignItems:"center",justifyContent:"center",height:"25px",fontSize:"12px",lineHeight:"17px",userSelect:"none"},"&:hover",{cursor:"pointer"})},onClick:o,children:["开通会员解锁全部会员表情 ",Object(s.b)(L.a,{})]})}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}var D={containerClass:"Emoticons-panelContainer",ContainerEl:"ul",threshold:10},V=function(e){Object(c.a)(n,e);var t=M(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={showVipStickerModal:!1},a.setShowVipStickerModal=function(e){a.setState({showVipStickerModal:e})},a.handleGetSwiperInstance=function(e){a.mousetrap=new v.a,a.swiperInstance=e,a.mousetrap.bind("left",(function(){e.slidePrev()})),a.mousetrap.bind("right",(function(){e.slideNext()}))},a.handleEmoticonGroupSelected=function(e){var t=a.props,n=t.getEmoticonsDetail,o=t.emoticonGroupDetail,c=t.changeSelectedEmoticonGroup,r=t.changeSelectedEmoticonPanel;o[e]||n(e),c(e),r("".concat(e,"-0"))},a.handleSlideChange=function(){var e=a.props,t=e.emoticonPanelList,n=e.getEmoticonsDetail,o=e.changeSelectedEmoticonPanel,c=e.changeSelectedEmoticonGroup;if(a.swiperInstance){var r=t[a.swiperInstance.activeIndex];o(r.id),c(r.groupId),0===r.data.length&&n(r.groupId)}},a.handleRequestVip=function(){a.setShowVipStickerModal(!0)},a.handleSelectEmoticon=function(e,t){var n=a.props,o=n.onSelectEmoticon,c=n.isVip;"vip"!==t||c?o(e,t):a.handleRequestVip()},a.swiperInstance=Object(l.createRef)(),a}return Object(a.a)(n,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.changeSelectedEmoticonGroup,n=e.changeSelectedEmoticonPanel,o=e.emoticonPanelList;t(o[0].groupId),n(o[0].id),this.mousetrap.reset()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.emoticonGroupList,a=void 0===o?[]:o,c=t.curEmoticonGroupId,r=t.emoticonPanelList,i=t.curEmoticonPanelId,l=t.isVip,m=t.vipEnabled,u=void 0!==m&&m,d=t.Swiper,p=t.noBorder,h=void 0!==p&&p,f=this.state.showVipStickerModal,v=this.setShowVipStickerModal,C=Object(N.a)(u,r);return Object(s.b)(O.b,{block:"EmoticonsCard",children:Object(s.c)("div",{className:b()("Emoticons",{"Emoticons--bordered":!h},n),children:[d?Object(s.b)(d,Object.assign(Object.assign({},D),{},{activeSlideKey:i,getSwiper:this.handleGetSwiperInstance,on:{slideChange:this.handleSlideChange},children:C.map((function(t){return Object(s.b)("li",{className:"Emoticons-panels-item",children:Object(s.b)(P,{type:t.type,data:t.data,onSelectEmoticon:e.handleSelectEmoticon})},t.id)}))})):Object(s.b)("div",{css:{height:183}}),Object(s.b)(T,{className:"Emoticons-Pagination"}),Object(s.b)(A,{show:u&&!l,onClick:this.handleRequestVip}),Object(s.b)(I,{emoticonGroupList:a,curEmoticonGroupId:c,onGroupSelected:this.handleEmoticonGroupSelected,vipEnabled:u}),Object(s.b)(R.b,{show:f,setShow:v,type:R.a.comment_sticker})]})})}}]),n}(l.Component);V.propTypes={className:p.a.string,onSelectEmoticon:p.a.func};t.a=Object(u.compose)(Object(m.connect)((function(e){var t=e.emoticons,n=t.emoticonGroupList,o=t.curEmoticonGroupId,a=t.emoticonGroupDetail,c=t.emoticonPanelList;return{emoticonGroupList:n,curEmoticonGroupId:o,emoticonGroupDetail:a,emoticonPanelList:void 0===c?[]:c,curEmoticonPanelId:t.curEmoticonPanelId,isVip:Object(g.i)(e)}}),{getEmoticonsDetail:j.e,changeSelectedEmoticonGroup:j.a,changeSelectedEmoticonPanel:j.b}),Object(y.a)(null),(function(e){return function(t){var o=Object(C.d)((function(){return Promise.all([n.e(35),n.e(42)]).then(n.t.bind(null,1760,7))}));return Object(s.b)(e,Object.assign(Object.assign({},t),{},{Swiper:o}))}}))(V)},1430:function(e,t,n){"use strict";var o=n(17),a=n(0),c=n(79),r=n.n(c),i=n(19),s=n(348),l=n(15),m=n(174);function u(e){return e.reduce((function(e,t){var n;return[].concat(Object(l.a)(e),Object(l.a)(null!==(n=t.stickers)&&void 0!==n?n:[]))}),[])}var d=function(){return window.zh_emoticon?Promise.resolve(u(window.zh_emoticon)):Object(m.loadScript)("https://unpkg.zhimg.com/@cfe/emoticon@1.2.2/lib/emoticon.js").then((function(){return window.zh_emoticon?u(window.zh_emoticon):[]}))},p=n(1);t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return r()((function(t){var c=Object(p.useState)(!1),r=Object(o.a)(c,2),l=r[0],m=r[1];return Object(p.useEffect)((function(){Object(s.c)()?m(!0):d().then((function(e){Object(s.e)(Object(i.camelizeKeys)(e)),m(!0)})).catch((function(){m(!0)}))}),[]),(l||n)&&Object(a.b)(e,Object.assign({},t))}),e)}}},1490:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var o=n(25),a=n.n(o),c=n(29),r=n.n(c),i=n(30),s=n.n(i),l=n(33),m=n.n(l),u=n(22),d=n.n(u),p=n(73),h=n.n(p),b=n(1),f=n(7),v=n.n(f),C=n(18),O=n(3);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=d()(e);if(t){var a=d()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var g=function(e){s()(n,e);var t=j(n);function n(){var e;a()(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).handleClick=function(){var t=e.props;(0,t.onSelect)(t.page)},e}return r()(n,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return Object(O.e)(C.c,{preset:C.b.Plain,className:v()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),n}(b.Component);function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=d()(e);if(t){var a=d()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},(function(t,n){return n+e}))},k=function(e){s()(n,e);var t=y(n);function n(){return a()(this,n),t.apply(this,arguments)}return r()(n,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,o=t.className,a=t.clickCallback,c=this.props.current,r=this.props.total,i=a&&(e=a,function(){e.apply(void 0,arguments)})||n,s=function(e,t){var n="...";return t<=5?R(1,t):e>t-3?[1,n].concat(h()(R(t-3,3)),[t]):e<=3?[1].concat(h()(R(2,3)),[n,t]):[1,n].concat(h()(R(e-Math.floor(1.5),3)),[n,t])}(c,r);return Object(O.e)("div",{className:v()("Pagination",o)},c>1&&c<=r&&Object(O.e)(g,{className:"PaginationButton-prev",onSelect:i,text:"上一页",page:c-1}),s.map((function(e,t){return"number"==typeof e?Object(O.e)(g,{onSelect:i,text:e,page:e,key:t,isCurrent:c===e}):Object(O.e)("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)})),c>0&&c<r&&Object(O.e)(g,{className:"PaginationButton-next",onSelect:i,text:"下一页",page:c+1}))}}]),n}(b.Component);k.defaultProps={current:1,total:1,onSelect:function(){}}},1493:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var o=n(10),a=n(11),c=n(13),r=n(14),i=n(6),s=n(0),l=n(1),m=n(184);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}var d=function(e){Object(c.a)(n,e);var t=u(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.onRef;return Object(s.b)("div",{className:"Comments-pattern-loading",ref:e,children:Object(s.b)(m.a,{})})}}]),n}(l.PureComponent)},1494:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var o=n(17),a=n(0),c=n(1),r=n(398),i=n(883),s=n(142),l=n.n(s);function m(e){var t=e.onClick,n=e.commentsElRef,s=Object(c.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(c.useState)(0),h=Object(o.a)(p,2),b=h[0],f=h[1];return Object(c.useEffect)((function(){var e=n.current;if(e){var t=e.getBoundingClientRect().right;f(t-16)}}),[n]),Object(c.useEffect)((function(){var e=l()((function(){var e=n.current;if(e){var t=window.innerHeight,o=e.getBoundingClientRect(),a=o.top,c=o.bottom,r=o.height;d(r>500&&c>t&&a<0)}}),100);return window.addEventListener("scroll",e),function(){e.cancel(),window.removeEventListener("scroll",e)}}),[n]),Object(r.c)(u,null,{from:{opacity:0,left:b},enter:{opacity:1,left:b},leave:{opacity:0,left:b}}).map((function(e){var n=e.item,o=e.key,c=e.props;return n&&Object(a.c)(r.a.button,{style:c,onClick:t,className:"CommentCollapseButton",children:["收起评论",Object(a.b)(i.a,{center:!0})]},o)}))}},1504:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1),a=n.n(o),c=n(8),r=Object.assign;function i(e){return a.a.createElement(c.a,r(r({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"EyeFill24","data-old-api":"Eye"},e),{className:"Zi Zi--Eye"+(e.className?" ".concat(e.className):"")}),a.a.createElement("path",{d:"M21.675 15.423c-1.392 2.207-4.33 5.294-9.674 5.294-5.34 0-8.28-3.083-9.674-5.29a5.882 5.882 0 01-.392-5.534c1.15-2.605 3.963-6.61 10.066-6.61 6.107 0 8.918 4.01 10.066 6.615a5.88 5.88 0 01-.392 5.525zM9.734 11.937a2.165 2.165 0 012.72-2.093.75.75 0 10.383-1.45 3.669 3.669 0 00-4.603 3.543 3.665 3.665 0 107.216-.908.75.75 0 00-1.453.37 2.168 2.168 0 01-2.098 2.703 2.165 2.165 0 01-2.165-2.165z",fillRule:"evenodd",clipRule:"evenodd"}))}},1595:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1),a=n.n(o),c=n(8),r=Object.assign;function i(e){return a.a.createElement(c.a,r(r({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ImagePlus24","data-old-api":"AddImage"},e),{className:"Zi Zi--AddImage"+(e.className?" ".concat(e.className):"")}),a.a.createElement("path",{d:"M3 5.42a2.415 2.415 0 012.415-2.416h13.17a2.415 2.415 0 012.414 2.415V11.5a.75.75 0 01-1.5 0V5.42a.915.915 0 00-.915-.916H5.415a.915.915 0 00-.915.915v7.42a.75.75 0 01-1.5 0V5.42zm12.09 8.022a5.57 5.57 0 00-3.192 1.005l-2.053 1.435a8.52 8.52 0 01-4.882 1.538H4.5v1.16c0 .506.41.916.915.916H14a.75.75 0 010 1.5H5.415A2.415 2.415 0 013 18.58v-1.356c0-.72.585-1.305 1.305-1.305h.658a7.02 7.02 0 004.023-1.267l2.052-1.435a7.07 7.07 0 014.051-1.276h.191a.75.75 0 110 1.5h-.19zM6.5 8.937a2.417 2.417 0 114.833 0 2.417 2.417 0 01-4.833 0zm2.417-.917a.917.917 0 100 1.834.917.917 0 000-1.834zM19.5 14a.75.75 0 01.75.75v2h2a.75.75 0 010 1.5h-2v2a.75.75 0 01-1.5 0v-2h-2a.75.75 0 010-1.5h2v-2a.75.75 0 01.75-.75z",fillRule:"evenodd",clipRule:"evenodd"}))}},1596:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1),a=n.n(o),c=n(8),r=Object.assign;function i(e){return a.a.createElement(c.a,r(r({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"EmoHappy24","data-old-api":"Emotion"},e),{className:"Zi Zi--Emotion"+(e.className?" ".concat(e.className):"")}),a.a.createElement("path",{d:"M12 20.5a8.5 8.5 0 100-17 8.5 8.5 0 000 17zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",fillRule:"evenodd",clipRule:"evenodd"}),a.a.createElement("path",{d:"M10 10.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm6.5 0a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0z"}),a.a.createElement("path",{d:"M8.712 13.807a.75.75 0 01.98.406 2.488 2.488 0 001.352 1.347 2.503 2.503 0 003.263-1.347.75.75 0 011.386.575 3.99 3.99 0 01-2.164 2.159 4.004 4.004 0 01-5.222-2.16.75.75 0 01.405-.98z",fillRule:"evenodd",clipRule:"evenodd"}))}},1687:function(e,t,n){var o=n(698),a=n(349),c=n(444),r=Math.max,i=Math.min;e.exports=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var l=s-1;return void 0!==n&&(l=c(n),l=n<0?r(s+l,0):i(l,s-1)),o(e,a(t,3),l,!0)}},1758:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1),a=n.n(o),c=n(8),r=Object.assign;function i(e){return a.a.createElement(c.a,r(r({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowShapeTurnLeftFill24","data-old-api":"Reply"},e),{className:"Zi Zi--Reply"+(e.className?" ".concat(e.className):"")}),a.a.createElement("path",{d:"M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z",fillRule:"evenodd",clipRule:"evenodd"}))}},1764:function(e,t,n){"use strict";n.r(t);var o=n(27),a=n(10),c=n(11),r=n(13),i=n(14),s=n(6),l=n(0),m=n(1),u=n.n(m),d=n(2),p=n.n(d),h=n(61),b=n(12),f=n(26),v=n(7),C=n.n(v),O=n(488),j=n(1687),g=n.n(j),y=n(9),R=n(125),k=n(1490),N=n(48),I=n(38),w=n(65),S=n(171),P=n(49),E=n(92),B=n(1369),T=n(1341),x=n(1430),L=n(348),z=function(e){return Object.assign(Object.assign({},e),{},{richText:Object(L.d)(e.content)})},A=n(99),M=n(15),D=n(66),V=n(45),F=n(16),_=n(100),q=n.n(_),U=n(46),H=n.n(U),G=n(18),W=n(516),Z=n(85),K=n(143),Y=n(1408),J=n(392),X=n(17),Q=n(53),$=n.n(Q),ee=n(147),te=n(193),ne=n(708),oe=n(1195),ae=n(1595),ce=n(20),re=n(1378),ie=n(257),se=n(28),le="zhihu::comment_local_key",me=(se.I,function(){return""}),ue="上传失败",de="上传中",pe="",he="emoticon",be="selected",fe="image",ve=Object(m.forwardRef)((function(e,t){var n=e.children,o=Object(m.useRef)(!1),a=Object(m.useRef)(null),c=Object(m.useRef)(null),r=Object(m.useRef)(null),i=Object(ce.c)((function(){var e,t,n;null===(e=a.current)||void 0===e||e.position(),null===(t=c.current)||void 0===t||t.position(),null===(n=r.current)||void 0===n||n.position()})),s=Object(ce.c)((function(){var e;null===(e=a.current)||void 0===e||e.open()})),l=Object(ce.c)((function(){var e,t,n;null===(e=r.current)||void 0===e||e.open(),null===(t=c.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),u=Object(ce.c)((function(){var e;null===(e=r.current)||void 0===e||e.close()})),d=Object(ce.c)((function(){var e,t,n;null===(e=c.current)||void 0===e||e.open(),null===(t=r.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),p=Object(ce.c)((function(){var e;null===(e=c.current)||void 0===e||e.close()})),h=Object(ce.c)((function(){var e,t,n;null===(e=r.current)||void 0===e||e.close(),null===(t=c.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),b=Object(ce.c)((function(){var e,t;o.current||(o.current=!0,null===(e=c.current)||void 0===e||e.open(),null===(t=r.current)||void 0===t||t.open(),Promise.resolve().then((function(){var e,t;null===(e=c.current)||void 0===e||e.close(),null===(t=r.current)||void 0===t||t.close()})))})),f=Object(m.useState)({register:function(e,t){e===he&&(a.current=t),e===be&&(c.current=t),e===fe&&(r.current=t)},position:i,openEmoticon:s,openImage:l,openSelected:d,closeImage:u,closeSelected:p,closeAll:h,prepare:b}),v=Object(X.a)(f,1)[0];return Object(m.useImperativeHandle)(t,(function(){return v})),n&&n.map((function(e){return Object(m.cloneElement)(e,{popoversController:v})}))})),Ce=n(62),Oe=Object.assign;var je=function(e){return u.a.createElement(Ce.a,Oe({width:"21",height:"14",fill:"none"},e),u.a.createElement("path",{fill:"url(#A)",stroke:"#f6f6f6",d:"M7.486.504a6 6 0 100 12h7a6 6 0 100-12h-7z"}),u.a.createElement("g",{fill:"#935d14"},u.a.createElement("path",{d:"M8.459 9.431l2.465-5.366h-.916L8.401 7.751l-1.6-3.687h-.923L8.35 9.431h.109zm3.825 0V4.065h-.814v5.366h.814zm2.05 0V7.445h.284c.659 0 1.156-.153 1.491-.46s.502-.747.502-1.321c0-.496-.154-.887-.462-1.172s-.794-.427-1.458-.427h-1.178v5.366h.822zm.305-2.708h-.305V4.78h.378c.388 0 .664.09.829.27s.247.414.247.701c0 .268-.085.496-.254.686s-.468.285-.894.285z",fillRule:"evenodd"}),u.a.createElement("path",{d:"M8.459 9.431v.146h.094l.039-.085-.133-.061zm2.465-5.366l.133.061.095-.207h-.228v.146zm-.916 0v-.146h-.096l-.038.088.134.058zM8.401 7.751l-.134.058.134.309.134-.309-.134-.058zm-1.6-3.687l.134-.058-.038-.088h-.096v.146zm-.923 0v-.146h-.229l.096.208.133-.061zM8.35 9.431l-.133.061.039.085h.094v-.146zm3.934 0v.146h.146v-.146h-.146zm0-5.366h.146v-.146h-.146v.146zm-.814 0v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm2.865 0v.146h.146v-.146h-.146zm0-1.986v-.146h-.146v.146h.146zm-.822-3.38v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm.822-2.708h-.146v.146h.146v-.146zm0-1.942v-.146h-.146v.146h.146zM8.592 9.492l2.465-5.366-.266-.122L8.326 9.37l.266.122zm2.332-5.573h-.916v.293h.916v-.293zm-1.05.088L8.267 7.693l.268.117 1.607-3.687-.268-.117zM8.535 7.693l-1.6-3.687-.269.116 1.6 3.687.268-.116zM6.801 3.918h-.923v.293h.923v-.293zm-1.056.208l2.472 5.366.266-.122-2.472-5.366-.266.122zM8.35 9.577h.109v-.293H8.35v.293zm4.08-.146V4.065h-.293v5.366h.293zm-.146-5.512h-.814v.293h.814v-.293zm-.961.146v5.366h.293V4.065h-.293zm.146 5.512h.814v-.293h-.814v.293zm3.011-.146V7.445h-.293v1.986h.293zm-.146-1.839h.284v-.293h-.284v.293zm.284 0c.68 0 1.218-.158 1.589-.498l-.198-.216c-.297.273-.753.421-1.392.421v.293zm1.589-.498c.372-.341.549-.826.549-1.429h-.293c0 .545-.158.942-.454 1.214l.198.216zm.549-1.429c0-.529-.166-.962-.509-1.279l-.199.215c.272.252.415.6.415 1.064h.293zm-.509-1.279c-.347-.321-.877-.466-1.557-.466v.293c.648 0 1.09.14 1.358.388l.199-.215zM14.69 3.92h-1.178v.293h1.178V3.92zm-1.324.146v5.366h.293V4.065h-.293zm.146 5.512h.822v-.293h-.822v.293zm1.127-3.001h-.305v.293h.305v-.293zm-.159.146V4.78h-.293v1.942h.293zm-.146-1.796h.378v-.293h-.378v.293zm.378 0c.37 0 .597.087.721.223l.216-.198c-.205-.224-.532-.318-.937-.318v.293zm.721.223c.136.148.209.345.209.602h.293c0-.317-.092-.588-.286-.8l-.216.198zm.209.602a.85.85 0 01-.217.589l.218.195a1.14 1.14 0 00.292-.784h-.293zm-.217.589c-.128.143-.373.236-.785.236v.293c.441 0 .792-.097 1.003-.334l-.218-.195z"})),u.a.createElement("defs",null,u.a.createElement("linearGradient",{id:"A",x1:"1.986",x2:"19.986",y1:"12.004",y2:"12.004",gradientUnits:"userSpaceOnUse"},u.a.createElement("stop",{stopColor:"#f8e2c4"}),u.a.createElement("stop",{offset:"1",stopColor:"#f3bb6c"}))))},ge=["showVipBadge"];function ye(e){var t=e.images,n=e.onClick,o=e.onReset,a=Object(m.useState)(!1),c=Object(X.a)(a,2),r=c[0],i=c[1],s=Object(ce.c)((function(){return i(!0)})),u=Object(ce.c)((function(){return i(!1)}));return Object(l.c)(m.Fragment,{children:[Object(l.c)("div",{onMouseEnter:s,onMouseLeave:u,css:{width:"110px",height:"110px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[Object(l.b)("img",{src:t[0].src,alt:""}),r&&Object(l.b)(Re,{onClick:n})]}),Object(l.b)("div",{className:"closeButton",onClick:o,css:function(e){return{color:e.colors.GBK06A}},children:Object(l.b)(oe.a,{})})]})}function Re(e){var t=e.onClick;return Object(l.b)("div",{role:"button",tabIndex:0,css:{position:"absolute",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",borderRadius:"4px","&:hover":{cursor:"pointer"}},onClick:t,children:Object(l.b)("div",{css:function(e){return{color:e.colors.GBK99B,lineHeight:"27px",width:"74px",borderRadius:"20px",borderColor:"#fefefe",borderWidth:"1px",borderStyle:"solid",fontSize:"12px",textAlign:"center"}},children:"更换图片"})})}var ke=Object(m.forwardRef)((function(e,t){var n=e.showVipBadge,a=Object(o.default)(e,ge);return Object(l.b)(y.a,Object.assign({as:te.a,zaType:"Button",zaEventType:"Click",zaBlock:"AppendImage",label:"插入图片",ref:t,icon:Object(l.c)(m.Fragment,{children:[Object(l.b)(ae.a,{}),n&&Object(l.b)(je,{css:{position:"absolute",transform:"translate(10px, -6.5px)",width:"20px",height:"13px"}})]})},a))})),Ne=Object(f.compose)(Object(b.connect)((function(e){return{isVip:Object(P.i)(e)}}),{showNotification:I.g,uploadImage:ie.b}),Z.a)((function(e){var t=e.popoversController,n=Object(m.useState)(pe),o=Object(X.a)(n,2),a=o[0],c=o[1],r=Object(m.useState)(!1),i=Object(X.a)(r,2),s=i[0],u=i[1],d=Object(m.useRef)();Object(m.useEffect)((function(){t.register(fe,d.current)}),[t]);var p=Object(m.useRef)(),h=Object(ce.c)((function(t){t.preventDefault(),(0,e.authRequired)((function(){var t,n=e.handleInputActive;e.hasPermission?(null===(t=p.current)||void 0===t||t.click(),n(!0)):u(!0)}))()})),b=function(){p.current&&(p.current.value=null)},f=function(){var t=e.handleImages,n=e.showNotification,o=e.resetUploadImg;t([]),n("图片上传失败","red"),o(),c(ue)},v=function(t){var n=e.handleImages,o=e.updatePublishStatus;n([Object.assign(Object.assign({},t.payload),{},{url:t.payload.src})]),o(!1),b(),c(pe)},C=Object(ce.c)((function(n){var o=e.showNotification;return n?n.size>1024*se.I*1024?(o("请上传小于 ".concat(se.I,"M 的图片。"),"red"),b(),!1):(t.openImage(),void c(de)):(b(),!1)})),O=Object(ce.c)((function(t){var n=t.file;return(0,e.uploadImage)(n).then(v).catch(f)})),j=Object(ce.c)((function(){var n=e.resetUploadImg,o=void 0===n?$.a:n;t.closeImage(),o()})),g=e.images,y=e.disableButton,R=e.hasPermission,k=e.onPopoverOpen,N=e.isVip,I=Boolean(g.length)&&a===pe,w=N||!R;return Object(l.c)(m.Fragment,{children:[Object(l.b)(ee.a,{className:"ImagePopover",arrowed:!0,ref:d,placement:"bottom",globalClose:!g.length,onOpen:k,onClick:h,toggler:Object(l.b)(ke,{disabled:y,showVipBadge:w}),children:Object(l.c)("div",{className:"ImagePopover-thumbnail",children:[I&&Object(l.b)(ye,{images:g,onClick:h,onReset:j}),a&&!I&&Object(l.b)("p",{className:"ImagePopover-uplodaStatus",children:a})]})}),Object(l.b)(ne.a,{accept:"image/png,image/jpeg",onRef:p,beforeUpload:C,customUpload:O}),Object(l.b)(re.b,{show:s,setShow:u,type:re.a.comment_img})]})})),Ie=n(71);function we(e){var t=e.onClose,n=e.onSubmit;return Object(l.c)(Ie.b,{className:"CommentCheckModal-wrapper",onClose:t,children:[Object(l.b)("div",{className:"CommentCheckModal-image"}),Object(l.b)("div",{className:"CommentCheckModal-title",children:"评论可能包含不友善内容"}),Object(l.b)("div",{className:"CommentCheckModal-content",children:"友善的交流是沟通的起点，请遵守知乎社区规范，认真友善发言"}),Object(l.c)("div",{className:"CommentCheckModal-button",children:[Object(l.b)(G.c,{className:"CommentCheckModal-submit",onClick:n,preset:"primary",children:"继续发布"}),Object(l.b)(G.c,{className:"CommentCheckModal-modify",onClick:t,preset:"primary",color:"blue",children:"返回修改"})]})]})}var Se=function(e){var t=e.url,n=e.title,o=e.onReset,a=void 0===o?$.a:o,c=e.popoversController,r=Object(m.useRef)();Object(m.useEffect)((function(){c.register(be,r.current)}),[c]);var i=Object(ce.c)((function(){c.closeSelected(),a()}));return Object(l.b)(ee.a,{arrowed:!0,globalClose:!1,ref:r,preventCloseOnTarget:!0,placement:"bottom",toggler:Object(l.b)("div",{css:{height:"28px",transform:"translateX(18px)"}}),children:Object(l.c)("div",{css:{width:"140px",height:"143px",position:"relative"},children:[Object(l.b)("img",{src:t,alt:n,css:{width:"100px",height:"100px",padding:"20px"}}),Object(l.b)("div",{onClick:i,css:{position:"absolute",width:"16px",height:"16px",right:"8px",top:"8px"},children:Object(l.b)(oe.b,{size:16})})]})})},Pe=n(1596),Ee=n(1428),Be=["onInsertEmoji","onAddSticker","vipEnabled"],Te=Object(m.forwardRef)((function(e,t){var n=e.onInsertEmoji,a=void 0===n?$.a:n,c=e.onAddSticker,r=void 0===c?$.a:c,i=e.vipEnabled,s=void 0!==i&&i,m=Object(o.default)(e,Be),u=Object(ce.c)((function(e,t){"emoji"===t?a(e.placeholder):r(e)}));return Object(l.b)(ee.a,Object.assign(Object.assign({arrowed:!0,preventCloseOnTarget:!0},m),{},{ref:t,children:Object(l.b)(Ee.a,{noBorder:!0,onSelectEmoticon:u,vipEnabled:s})}))}));var xe,Le=Object(Z.a)((function(e){var t=e.disabled,n=e.onInsertEmoji,o=void 0===n?$.a:n,a=e.onAddSticker,c=void 0===a?$.a:a,r=e.popoversController,i=Object(m.useRef)();Object(m.useEffect)((function(){r.register(he,i.current)}),[r]);var s=Object(ce.c)((function(){o.apply(void 0,arguments),setTimeout(r.position,400)})),u=Object(ce.c)((function(){r.openSelected(),c.apply(void 0,arguments),setTimeout(r.position,400)})),d=Object(ce.c)((function(t){(0,e.authRequired)([$.a,function(){t.preventDefault()}])()}));return Object(l.b)(Te,{ref:i,onInsertEmoji:s,onAddSticker:u,vipEnabled:!0,onClick:d,toggler:Object(l.b)(te.a,{label:"插入表情",icon:Pe.a,disabled:t,onMouseEnter:r.prepare})})}));function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}function Ae(e){var t=e.dynamicImageUrl||e.staticImageUrl,n=e.id,o=e.title||"[sticker]";return'<a class="comment_sticker" href="'.concat(t,'" data-sticker-id="').concat(n,'">').concat(o,"</a>")}function Me(e){var t=e.url,n=e.dataRawwidth,o=e.dataRawheight,a=e.title,c=t.includes(".gif")?"comment_gif":"comment_img";return'<a class="'.concat(c,"\" href='").concat(t,"' data-width='").concat(n||"","' data-height='").concat(o||"","'>[").concat(a||"图片","]</a>")}var De=function(e){Object(r.a)(n,e);var t=ze(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).zaRef=Object(m.createRef)(),e.state={active:!1,hasNoContent:!0,shown:!1,submitting:!1,value:{toHTML:me},images:[],uploadIsFetchingNum:0,stickers:[],toggleInputStyle:!1,commentTextLength:0,showCommentCheckModal:!1},e.isClubPostPage=function(){var t=e.props,n=t.type,o=(t.replyTo||{}).resourceType;return"club_post"===n||"club_post"===o},e.handleCheckClosed=function(){e.setState({showCommentCheckModal:!1}),e.trackCommentCheckClick("返回修改"),e.input.focus()},e.handleCommentCheck=function(){e.setState({showCommentCheckModal:!1}),e.handleSubmit(!1),e.trackCommentCheckClick("继续发布")},e.handleButtonSubmit=function(){e.handleSubmit(!0,"0"!==e.props.autoCheckAb)},e.handleSubmit=e.props.authRequired((function(t,n){return e.context.realNameRequired((function(){var o=e.props,a=o.replyTo,c=o.onSubmit,r=o.onCancel,i=o.rootCommentId,s=o.isConversation,l=o.zaInfo.zaSubmitCommentId;if(!e.state.submitting){e.setState({submitting:!0});var m=e.state,u=m.images,d=m.stickers,p=e.input.toHTML();if(p||u.length||d.length){var h;p&&e.saveLocalComment();var b=p;u.length&&(b+=Me(u[0])),d.length&&(b+=Ae(d[0]));var f,v=c(b,a,{rootCommentId:i,isConversation:s},t,n);if(v.then)v.then((function(){var t;(r&&r(),e.input)?(e.input.reset(),null===(t=e.popoverControllerRef.current)||void 0===t||t.closeAll(),e.resetImage(),e.setState({value:{toHTML:me}},(function(){return e.saveLocalComment()}))):e.saveLocalComment({toHTML:me})})).catch((function(t){40313===t.payload.code&&e.setState({showCommentCheckModal:!0})})).finally((function(){e.setState({submitting:!1})}));else e.setState({submitting:!1}),r&&r(),e.input.reset(),null===(f=e.popoverControllerRef.current)||void 0===f||f.closeAll();F.a.trackEvent(Object(D.a)(e),Object.assign({action:"Comment",element:"Button"},l&&{id:l})),null===(h=e.zaRef.current)||void 0===h||h.trackEvent({eventType:"Click",action:"Comment",elementLocation:{type:"Button"}})}}}))()}),e.isClubPostPage()?se.M.reply_club:void 0,I.b),e.handleCommentShow=e.props.authRequired((function(){e.setState({shown:!0}),e.hiddenInput.focus()})),e.handleCommentHide=function(){e.setState({shown:!1})},e.initLocalComment=function(){var t=e.props,n=t.type,o=t.id;if(n&&o){var a=H.a.get(le)||[],c="".concat(n,"_").concat(o),r=a.find((function(e){return e.key===c})),i=r&&r.value;i&&e.setState({value:{toHTML:function(){return i}},hasNoContent:!1})}},e.saveLocalComment=function(t){var n=e.props,o=n.type,a=n.id;if(o&&a){var c=t?t.toHTML():e.state.value.toHTML(),r="".concat(o,"_").concat(a),i=(H.a.get(le)||[]).filter((function(e){return e.key!==r})),s=c?[].concat(Object(M.a)(i.slice(0,4)),[{key:r,value:c}]):i;H.a.set(le,s)}},e.handleChange=function(t){var n=e.state,o=n.stickers,a=n.images;o.length||a.length?e.setState({value:t}):e.setState({value:t,hasNoContent:t.isEmpty}),e.handleInputChange()},e.handleFocus=function(){e.setState({active:!0},e.handleInputChange)},e.handleBlur=function(){var t=e.state,n=t.stickers,o=t.images;n.length||o.length||(e.setState({active:!1}),e.handleInputChange())},e.handleMobileComment=function(){e.handleSubmit(),e.handleCommentHide()},e.handleInputChange=function(){var t,n,o=Object(V.findDOMNode)(e.input);o&&(o.getBoundingClientRect().height>40?e.setState({toggleInputStyle:!0}):e.setState({toggleInputStyle:!1}),n="innerText"in document?o.innerText.length:o.textContent.length,e.setState({commentTextLength:n}),null===(t=e.popoverControllerRef.current)||void 0===t||t.position())},e.handleImages=function(t){var n;e.setState({images:t},null===(n=e.popoverControllerRef.current)||void 0===n?void 0:n.position)},e.handleInputActive=function(t){e.setState({active:t})},e.updatePublishStatus=function(t){e.setState({hasNoContent:t})},e.resetStickers=function(){var t=e.state.value,n=void 0===t.isEmpty||t.isEmpty;e.setState({stickers:[],hasNoContent:n})},e.resetImage=function(){e.resetStickers(),e.resetUploadImg()},e.resetUploadImg=function(){var t=e.state.value,n=void 0===t.isEmpty||t.isEmpty;e.setState({images:[],hasNoContent:n})},e.insertEmoji=function(t){var n;null===(n=e.input)||void 0===n||n.handleCommand("insert-text:".concat(t))},e.addSticker=function(t){e.setState({stickers:[t],images:[],hasNoContent:!1})},e.handleImagePopoverOpen=function(){e.setState({stickers:[]})},e.focusInput=function(t){t.preventDefault(),e.input.focus()},e.popoverControllerRef=Object(m.createRef)(),e.renderInput=function(t){var n,o,a,c=t.placeholder,r=t.className,i=e.props,s=i.autoFocus,m=i.commentWithPicPermission.commentWithPic,u=e.state,d=u.images,p=u.stickers,h=u.toggleInputStyle,b=u.active,f=u.hasNoContent,v=u.commentTextLength;return Object(l.c)("div",{className:C()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":h,"CommentEditorV2-inputWrap--active":b||!f}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()},children:[Object(l.b)(K.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:e.focusInput}}),Object(l.b)(J.a,{className:C()("CommentEditorV2-input",r),defaultValue:e.state.value.toHTML(),allowMention:!0,allowPasteRichText:!1,autoFocus:s,outputBlockType:"div",ref:function(t){e.input=t},placeholder:c,onFocus:e.handleFocus,onChange:e.handleChange,onSubmit:e.handleButtonSubmit,minRows:5}),Object(l.c)("div",{className:C()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":h,"CommentEditorV2-inputUpload--SpaceBetween":h&&v>980}),children:[h&&v>980&&Object(l.b)(W.a,{className:"CommentEditorV2-MaxLength",current:v,max:1e3}),Object(l.b)("div",{className:"CommentEditorV2-popoverWrap",children:Object(l.c)(ve,{ref:e.popoverControllerRef,children:[Object(l.b)(Ne,{images:d,resetUploadImg:e.resetUploadImg,handleInputActive:e.handleInputActive,updatePublishStatus:e.updatePublishStatus,handleImages:e.handleImages,onPopoverOpen:e.handleImagePopoverOpen,hasPermission:m||e.isClubPostPage()}),Object(l.b)(Se,{url:(null===(n=p[0])||void 0===n?void 0:n.dynamicImageUrl)||(null===(o=p[0])||void 0===o?void 0:o.staticImageUrl),title:null===(a=p[0])||void 0===a?void 0:a.title,onReset:e.resetStickers}),Object(l.b)(Le,{onAddSticker:e.addSticker,onInsertEmoji:e.insertEmoji,preparePopoverIndex:e.preparePopoverIndex})]})})]})]})},e}return Object(c.a)(n,[{key:"trackCommentCheckClick",value:function(e){F.a.trackEvent(null,{id:7497,action:"Click",path:[{module_name:"图文弹窗"}]},{button:{text:e}})}},{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,a=e.ownerAuthorIsOrg,c=e.ownerAuthorIsBrand,r=e.commentStatus,i=e.brandCommentText,s=void 0===i?"":i,m=this.state,u=m.active,d=m.hasNoContent,p=m.submitting,h=m.showCommentCheckModal,b=a?"机构":"作者",f={preset:"primary",color:"blue",children:"发布",disabled:d||p},v="写下你的评论...";if(n&&(v=c&&s?s:a?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),t&&t.author){var O=t.author,j=O.member,g=O.mask,R=(null==j?void 0:j.name)||(null==g?void 0:g.name)||t.author.name;v=q()(xe||(xe=Object(A.a)(["回复","",""])),R,n?"，评论由".concat(b,"筛选后公开"):"")}return r&&!1===r.canComment&&(v=r.toast),Object(l.c)("div",{children:[Object(l.b)(y.d,{ref:this.zaRef}),Object(l.c)("div",{className:C()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":u||!d}),children:[this.renderInput({placeholder:v}),Object(l.b)(G.c,Object.assign(Object.assign({},f),{},{className:"CommentEditorV2-singleButton",onClick:this.handleButtonSubmit}))]}),h&&Object(l.b)(we,{onClose:this.handleCheckClosed,onSubmit:this.handleCommentCheck})]})}}]),n}(m.Component);De.propTypes={className:p.a.string,defaultActive:p.a.bool,replyTo:p.a.object,inCommentItem:p.a.bool,commentNeedsReview:p.a.bool,canComment:p.a.object,onCancel:p.a.func,onSubmit:p.a.func.isRequired,zaInfo:p.a.object},De.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1,zaInfo:{}},De.contextTypes={realNameRequired:p.a.func};var Ve=Object(f.compose)(h.withRouter,Object(Y.a)(),Z.a,Object(b.connect)((function(e){return{stickers:e.commentsV2.stickers||[],commentWithPicPermission:e.commentsV2.commentWithPicPermission||{}}}),{showNotification:I.g}))(De),Fe=n(1493),_e=n(1395),qe=n(1494),Ue=n(76),He=n(1293),Ge=n(1297),We=n(1263),Ze=n(1758),Ke=n(1248),Ye=n(1298),Je=n(1300),Xe=n(1504),Qe=n(8),$e=Object.assign;function et(e){return u.a.createElement(Qe.a,$e($e({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"Thumb24","data-old-api":"LikeOutline"},e),{className:"Zi Zi--LikeOutline"+(e.className?" ".concat(e.className):"")}),u.a.createElement("path",{d:"M13.22 8.75a1.5 1.5 0 01-.373-1.166l.114-1.022a3.326 3.326 0 00-1.64-3.246.88.88 0 00-1.321.762v.553c0 .501-.092.998-.272 1.466a4.918 4.918 0 01-4.59 3.153H4.5a.25.25 0 00-.25.25V19c0 .139.112.25.25.25H7c2.836 0 6.546.197 8.92.343a2.284 2.284 0 002.324-1.59l1.823-5.832a2.25 2.25 0 00-2.148-2.921h-3.581a1.5 1.5 0 01-1.118-.5zm1.26-2.5a4.826 4.826 0 00-2.407-4.232c-1.587-.919-3.573.226-3.573 2.06v.553c0 .317-.058.632-.172.928a3.418 3.418 0 01-3.19 2.191H4.5A1.75 1.75 0 002.75 9.5V19c0 .966.782 1.75 1.75 1.75H7c2.786 0 6.456.194 8.828.34a3.784 3.784 0 003.848-2.64l1.823-5.832c.754-2.414-1.05-4.868-3.58-4.868h-3.581l.114-1.023a4.86 4.86 0 00.029-.477z",fillRule:"evenodd",clipRule:"evenodd"}))}var tt=Object.assign;function nt(e){return u.a.createElement(Qe.a,tt(tt({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ChatBubble24","data-old-api":"SpeechBalloonOutline"},e),{className:"Zi Zi--SpeechBalloonOutline"+(e.className?" ".concat(e.className):"")}),u.a.createElement("path",{d:"M11.984 3C6.866 3 3 7.195 3 11.988 3 17.557 7.554 21 12 21c1.473 0 3.109-.393 4.44-1.178l.01-.006c.214-.13.335-.194.432-.224a.248.248 0 01.173 0l.02.006 1.662.493c.447.138.928.043 1.269-.271a1.27 1.27 0 00.348-1.29l-.004-.015-.553-1.85a.751.751 0 00-.011-.036c-.025-.07-.01-.104-.01-.104l.02-.032c.76-1.399 1.204-2.95 1.204-4.48C21 7.278 17.217 3 11.984 3zm0 1.5C7.73 4.5 4.5 7.988 4.5 11.988c0 .588.061 1.147.175 1.677C5.456 17.3 8.738 19.5 12 19.5c1.231 0 2.597-.334 3.674-.967.402-.246 1.031-.63 1.837-.37l1.282.38-.428-1.434a1.616 1.616 0 01.12-1.346c.654-1.209 1.015-2.51 1.015-3.75 0-3.959-3.163-7.513-7.516-7.513z",fillRule:"evenodd",clipRule:"evenodd"}))}var ot=n(122),at=n(149),ct=n(711),rt=n(178),it=n(394),st=n(491),lt=n(493),mt=n(313),ut=n(1423),dt=n(260),pt=n(63),ht=n(225),bt=["html","className","prefix"];function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var vt=function(e){Object(r.a)(n,e);var t=ft(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={previewImg:null},e.handlePreview=function(t){var n=t.target,o=e.props.onPreviewImage;"function"==typeof o?o(t).catch((function(){e.setState({previewImg:n})})):e.setState({previewImg:n})},e}return Object(c.a)(n,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imgNode=this.root.getElementsByClassName("origin_image zh-lightbox-thumb"),this.imagesNodes=Array.from([].concat(Object(M.a)(this.imagesGifNode),Object(M.a)(this.imagesNode),Object(M.a)(this.imagesStickerNode),Object(M.a)(this.imgNode))).map((function(t){var n=t.dataset||{},o=n.width,a=n.height,c=n.rawwidth,r=n.rawheight,i=Number(o||c),s=Number(a||r),l=document.createElement("div");l.className="Richtext-content_img",t.parentNode.replaceChild(l,t);var m=t.getAttribute("href")||t.getAttribute("src"),u=new Image,d=t.getAttribute("class");return"comment_sticker"!==d&&l.addEventListener("click",e.handlePreview),u.className=d,u.src=m,u.dataset.original=Object(pt.imgUrl)(m,"r"),u.dataset.rawwidth=i,u.onload=function(){i===s||"comment_sticker"===d?l.classList.add("Richtext-content_img-square"):i>s?l.classList.add("Richtext-content_img-square--wideShape"):l.classList.add("Richtext-content_img-square--highShape"),l.appendChild(u)},l}))}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach((function(e){Object(V.unmountComponentAtNode)(e)}))}},{key:"componentDidMount",value:function(){this.mount()}},{key:"UNSAFE_componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props,a=n.html,c=n.className,r=n.prefix,i=Object(o.default)(n,bt);return Object(l.c)("div",{className:C()("CommentRichText",c),ref:function(t){return e.root=t},children:[r,Object(l.b)(ht.a,Object.assign({html:a},i)),t&&Object(l.b)(dt.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}})]})}}]),n}(m.Component);function Ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Ot=function(e){Object(r.a)(n,e);var t=Ct(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).zaRef=Object(m.createRef)(),e.state={isReplying:!1,deleteModal:!1},e.toggleReply=e.props.authRequired((function(){var t=e.props,n=t.commentStatus,o=t.showNotification;n&&!1===n.canReply?o(n.toast,"red",I.b):e.setState({isReplying:!e.state.isReplying})}),"club_post"===e.props.type?se.M.reply_club:void 0,I.b),e.like=e.props.authRequired((function(t){var n=e.props;(0,n.onLike)(n.comment.id,t),e.zaRef.current.trackEvent({action:"Upvote",eventType:"Click",elementLocation:{type:"Button"}})}),se.M.like,I.b),e.dislike=e.props.authRequired((function(){var t=e.props;(0,t.onDislike)(t.comment.id),e.zaRef.current.trackEvent({action:"UnUpvote",eventType:"Click",elementLocation:{type:"Button"}})}),se.M.like,I.b),e.delete=function(){var t=e.props;return(0,t.onDelete)(t.comment.id)},e.feature=function(t){var n=e.props,o=n.onFeature,a=n.comment.id;o(t?"".concat(a,"_featured"):a)},e.collapse=function(){var t=e.props;(0,t.onCollapse)(t.comment.id)},e.approve=function(){var t=e.props;(0,t.onApprove)(t.comment.id)},e.reject=function(){var t=e.props;(0,t.onReject)(t.comment.id)},e.showConversation=function(t){var n=e.props;(0,n.onShowConversation)({commentId:n.comment.id,isAnchorComments:t})},e.stopReply=function(){e.setState({isReplying:!1})},e.closeReportModal=function(e){if(e){var t=e.result.payload,n=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?it.b.showModal({reportText:n}):t&&t.sarcasmRecommend||Object(rt.b)(n||"举报成功")}},e.handleCloseDelete=function(){return e.setState({deleteModal:!1})},e.handleDelete=function(){return e.setState({deleteModal:!0})},e.handleClick=function(t,n){var o=e.props.parent,a=o.type,c=o.id;Object(ot.e)(Object(at.a)({type:a,id:c},{utm_campaign:"routine",utm_medium:"internal",utm_source:"video",utm_content:n})),t.stopPropagation(),t.preventDefault()},e}return Object(c.a)(n,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:Object(l.b)("span",{className:"CommentItemV2-roleInfo",children:"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) "})}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=t.role,c=t.mask;return Object(l.c)(m.Fragment,{children:[Object(l.b)("span",{className:"CommentItemV2-reply",children:"回复"}),Object(l.b)(st.a,{noBadge:!0,noHoverCard:!0,user:o||c||{}}),this.renderRoleInfo(a,n)]})}},{key:"renderItem",value:function(){var e,t,n=this,o=this.props,a=o.isConversation,c=o.ownerAuthorIsOrg,r=o.parent,i=r.canComment,s=(i=void 0===i?{status:!0}:i).status,u=r.questionType,d=r.question,p=r.brand,h=o.parent,b=o.commentNeedsReview,f=o.comment,v=o.onReply,O=o.status,j=o.type,g=o.canOperate,y=o.commentPattern,R=o.rootCommentId,k=o.byComment,N=o.isReverseAndStatusOpen,I=o.hasRecommend,w=o.permission.canBrandAdminEdit,S=o.showCollapsed,P=o.isMobile,E=this.state.isReplying,B=f.id,T=f.author,x=f.richText,L=f.content,z=f.voteCount,A=f.replyToAuthor,M=f.isAuthor,D=f.createdTime,V=f.addressText,F=f.featured,_=f.voting,q=f.reviewing,U=f.disliked,H=f.resourceType,W=f.childCommentCount,Z=f.allowDelete,K=f.allowVote,Y=f.canRecommend,J=f.canCollapse,X=f.collapsedReason,Q=void 0===X?"":X,$=f.isDelete,ee=f.collapsed,te=f.top,ne=ee&&!S,oe=ne?"该评论已被折叠":$?function(e){var t=e.content,n=e.deleteReason;if(n){var o=JSON.stringify({button:{text:String(n.reasonId)}}).replace(/"/g,"&quot;");return'<a href="'.concat(n.url,'" target="_blank" data-za-detail-view-id="7641" data-za-extra="').concat(o,'">').concat(n.tip,"</a>")}return t}(f):x||L,ae=$||ne,ce=T||{},re=ce.role,ie=ce.mask,se=(null==T?void 0:T.member)||ie,le=Boolean(A),me=F&&(W>0||le)&&!a||k&&le||N&&le,ue=null!==(e=Object(ut.a)(j,d,p))&&void 0!==e?e:"",de=M||Z&&("question"!==j||"commercial"===u),pe=Object(l.c)("div",{className:"CommentItemV2-footer",children:[Object(l.c)(G.c,{className:C()("CommentItemV2-likeBtn",_&&"is-liked"),preset:"plain",onClick:this.like,disabled:M||!s,children:[Object(l.b)(He.a,{style:{marginRight:5},center:!0,size:16}),z>0?z:"赞"]}),ee&&Q&&Object(l.c)("div",{className:"CommentItemV2-walleTag",children:["阴阳怪气自动折叠"===Q&&Object(l.b)(Ge.a,{size:16,className:"CommentItemV2-walleIcon"}),Q]}),me&&Object(l.c)(G.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return n.showConversation(le)},children:[Object(l.b)(We.a,{style:{marginRight:5},center:!0,size:16}),"查看回复"]}),!M&&s&&!ee&&Object(l.c)(G.c,{preset:"plain",className:C()({"CommentItemV2-hoverBtn":!E}),onClick:this.toggleReply,children:[Object(l.b)(Ze.a,{style:{marginRight:5},center:!0,size:16}),E?"取消回复":"回复"]}),Y&&!I&&g&&Object(l.c)(G.c,{className:C()({"CommentItemV2-hoverBtn":!M&&!E}),preset:"plain",onClick:function(){return n.feature(F)},children:[Object(l.b)(Ke.a,{style:{marginRight:5},center:!0,size:16}),F?"取消推荐":"推荐"]}),J&&!M&&Object(l.c)(G.c,{className:C()({"CommentItemV2-hoverBtn":!M&&!E}),preset:"plain",onClick:this.collapse,children:[Object(l.b)(Ye.a,{style:{marginRight:5},center:!0,size:14}),ee?"取消折叠":"折叠"]}),K&&!M&&g&&Object(l.c)(G.c,{className:C()({"CommentItemV2-hoverBtn":!E}),preset:"plain",onClick:this.dislike,disabled:!s,children:[Object(l.b)(He.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),U?"取消踩":"踩"]}),M||Object(l.c)(m.Fragment,{children:[Object(l.b)(mt.a,{id:B,type:"comment",className:"CommentItemV2-hoverBtn",onModalShown:function(e,t){e||n.closeReportModal(t)},modalProps:Object.assign(Object.assign({},de&&{onDeleteComment:this.delete}),{},{notification:{failure:ct.a}})}),"question"===j&&"commercial"===u&&w&&Object(l.c)(G.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.reject,children:[Object(l.b)(Ye.a,{style:{marginRight:5},center:!0,size:16}),"隐藏"]})]}),de&&Object(l.c)(G.c,{className:C()({"CommentItemV2-hoverBtn":!M&&!E&&!E}),preset:"plain",onClick:this.handleDelete,children:[Object(l.b)(Je.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),Object(l.b)(it.a,{shown:this.state.deleteModal,id:B,onDelete:this.delete,onClose:this.handleCloseDelete})]});return t=E?Object(l.c)("div",{children:[pe,Object(l.b)(Ve,{type:"comment",id:B,commentNeedsReview:b,className:"CommentItemV2-editor",defaultActive:!0,replyTo:f,onCancel:this.stopReply,onSubmit:v,rootCommentId:R,isConversation:a,brandCommentText:ue})]}):"reviewing"===O?Object(l.c)("div",{className:"CommentItemV2-footer",children:[Object(l.c)(G.c,{preset:"plain",onClick:this.approve,children:[Object(l.b)(Xe.a,{style:{marginRight:5},center:!0,size:14}),"公开"]}),Object(l.c)(G.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.handleDelete,children:[Object(l.b)(Je.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),Object(l.b)(it.a,{shown:this.state.deleteModal,id:B,onDelete:this.delete,onClose:this.handleCloseDelete})]}):pe,Object(l.c)("div",{children:[Object(l.c)("div",{className:"CommentItemV2-meta",children:[se&&Object(l.b)(lt.a,{className:"CommentItemV2-avatar",noHoverCard:"fixed"===y||"club_post"===j,user:se}),se&&Object(l.b)(st.a,{noBadge:!0,noHoverCard:!0,user:se}),this.renderRoleInfo(re,H),this.renderReplyTo(),te&&Object(l.b)("span",{className:"CommentItemV2-officialTop",children:"官方置顶"}),q&&Object(l.b)(Ye.a,{className:"CommentItemV2-reviewing","data-tooltip":"".concat(!1===c?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),"aria-label":"".concat(!1===c?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),Object(l.c)("span",{className:"CommentItemV2-time",children:[V&&"".concat(V," · "),Object(Ue.toSmartString)(D)]})]}),Object(l.c)("div",{className:"CommentItemV2-metaSibling",children:[Object(l.b)(vt,{className:C()("CommentItemV2-content",{"CommentItemV2-shield":ae}),html:oe}),"zvideo"===h.type&&P&&Object(l.c)("div",{className:"CommentItemV2-zvideoFooter",children:[Object(l.c)("div",{role:"button",tabIndex:0,onClick:function(e){return n.handleClick(e,"agree")},children:[z>0&&z,_?Object(l.b)(He.a,{style:{marginRight:20,marginLeft:5},center:!0,size:14}):Object(l.b)(et,{style:{marginRight:20,marginLeft:5},center:!0,size:14})]}),Object(l.b)("div",{role:"button",tabIndex:0,"aria-label":"回复",onClick:function(e){return n.handleClick(e,"reply")},children:Object(l.b)(nt,{center:!0,size:14})})]}),!ae&&t]})]})}},{key:"render",value:function(){var e=this.props,t=e.comment,n=e.onRef;return Object(l.c)(y.b,{content:{type:"Comment",id:String(t.id)},children:[Object(l.b)(y.d,{ref:this.zaRef}),Object(l.b)("div",{className:"CommentItemV2",ref:n,children:this.renderItem()})]})}}]),n}(m.Component);Ot.propTypes={comment:p.a.object.isRequired,parent:p.a.object.isRequired,commentNeedsReview:p.a.bool,type:p.a.string,isConversation:p.a.bool,onLike:p.a.func.isRequired,onShowConversation:p.a.func,onReply:p.a.func,onFeature:p.a.func,onDelete:p.a.func.isRequired,onCollapse:p.a.func,commentPattern:p.a.string,showCollapsed:p.a.bool};var jt=Object(f.compose)(h.withRouter,Z.a,Object(b.connect)((function(e){return{isWechat:e.env.userAgent.Wechat,permission:Object(E.n)(e),isMobile:e.env.userAgent.Mobile}}),{showNotification:I.g}))(Ot),gt=n(4);function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Rt=function(e){Object(r.a)(n,e);var t=yt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={},e.handleClick=function(){var t=e.props,n=t.loadRestComments,o=t.onShowConversation,a=t.comment,c=a.id,r=a.childCommentCount,i=r<=5&&r>2;(i?n:o)({commentId:c}),i&&e.setState(Object(gt.a)({},"hide_".concat(c),!0))},e.handleRef=function(t){var n=e.props.onRef;"function"==typeof n&&n(t)},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,a=e.isFetching,c=e.className,r=this.state["hide_".concat(n)],i=o<=5&&o>2?"展开其他 ".concat(o-2," 条回复"):"查看全部 ".concat(o," 条回复");return Object(l.c)("div",{className:c,ref:this.handleRef,children:[!r&&Object(l.b)("div",{className:"CommentMoreReplyButton",children:Object(l.b)(G.c,{preset:"plain",onClick:this.handleClick,children:i})}),a&&Object(l.b)(R.a,{className:"CommentMoreReplyButton",small:!0})]})}}]),n}(m.Component);function kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}Rt.propTypes={comment:p.a.object.isRequired,isFetching:p.a.bool,onShowConversation:p.a.func,loadRestComments:p.a.func};var Nt=function(e){Object(r.a)(n,e);var t=kt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).loadRestComments=function(t){var n=t.commentId;(0,e.props.loadConversation)({id:n,isLoadRest:!0})},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author,a=(o=void 0===o?{isOrg:!1}:o).isOrg,c=e.parent,r=e.commentNeedsReview,i=e.onShowConversation,s=e.status,u=e.onItemLike,d=e.onItemDelete,p=e.onItemCollapse,h=e.onItemDislike,b=e.onItemApprove,f=e.onItemReject,v=e.canOperateItem,O=e.commentPattern,j=e.commentStatus,g=e.conversation,y=void 0===g?{}:g,R=e.entities,k=e.byComment,N=e.isReverseAndStatusOpen,I=e.comment,w=e.onReply,S=e.onFeature,P=e.ids,E=e.showCollapsed,B=I.id,T=I.featured,x=I.childComments,L=void 0===x?[]:x,A=I.childCommentCount,M=void 0===A?0:A,D=T?"".concat(B,"_featured"):"".concat(B),V=!T&&P.includes("".concat(B,"_featured")),F=Boolean(L.length)&&!N,_=M<=5&&M>2,q=L.map((function(e){return R.comments[e]})).map(z),U=!T&&M>2&&!N,H=(_&&y[B]||{isFetching:!1}).isFetching;return Object(l.c)(m.Fragment,{children:[Object(l.b)("li",{className:C()({"NestComment--rootCommentNoChild":!F,"NestComment--rootComment":F}),children:Object(l.b)(jt,{comment:I,status:s,type:n,parent:c,canOperate:v,commentNeedsReview:r,onShowConversation:i,ownerAuthorIsOrg:a,onLike:u,onReply:w,onFeature:S,onDelete:d,onCollapse:p,onDislike:h,onApprove:b,onReject:f,commentPattern:O,commentStatus:j,rootCommentId:B,byComment:k,isReverseAndStatusOpen:N,hasRecommend:V,showCollapsed:E},D)},D),F&&q.map((function(e){var t=e.id,o=e.featured,m=o?"".concat(t,"_featured"):"".concat(t),C=!o&&P.includes("".concat(t,"_featured"));return Object(l.b)("li",{className:"NestComment--child",children:Object(l.b)(jt,{comment:e,status:s,type:n,parent:c,canOperate:v,commentNeedsReview:r,onShowConversation:i,ownerAuthorIsOrg:a,onLike:u,onReply:w,onFeature:S,onDelete:d,onCollapse:p,onDislike:h,onApprove:b,onReject:f,commentPattern:O,commentStatus:j,rootCommentId:B,hasRecommend:C,showCollapsed:E},m)},m)})),U&&Object(l.b)(Rt,{comment:I,isFetching:H,onShowConversation:i,loadRestComments:this.loadRestComments})]})}}]),n}(m.Component),It=Object(f.compose)(Object(b.connect)(null,{loadConversation:O.h}))(Nt);function wt(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var a=n.featured,c=n.replyToAuthor,r=n.id;return t===r&&a?c?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==r||c?t!==r&&c?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Pt=function(e){Object(r.a)(n,e);var t=St(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=Object(m.createRef)(),e.paginationZARef=Object(m.createRef)(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var a=t||e.props,c=a.order,r=a.status,i=a.parent,s=i.id,l=i.type,m=a.commentPattern,u=a.needLoadCommentPermission,d=a.loadComments,p=a.notificationId,h=a.loadNotificationComments;if(p)return h(p);u&&e.loadCommentPermission(l,s),d(l,s,{order:c,isPrevious:n,commentPattern:m,status:o?"collapsed":r},o)}},e.addComment=function(t,n,o,a,c){var r=o.rootCommentId,i=o.isConversation,s=e.props,l=s.parent,m=l.id,u=l.type,d=s.commentId,p=s.addComment,h=s.notificationId;return p({parentType:u,parentId:m,content:t,replyTo:n,conversationId:d,rootCommentId:r,isConversation:i,notificationId:h,replyType:wt({id:r,replyTo:n,isConversation:i,isNotification:Boolean(h)}).type,useStrictMode:a,enableUnfriendlyCheck:c})},e.featureItem=function(t){(0,e.props.onItemFeature)(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.trackPaginationClick=function(t,n){var o;o=n===t+1?{text:"下一页",block:{blockText:"CommentPageNext"}}:n===t-1?{text:"上一页",block:{blockText:"CommentPageBefore"}}:{text:"".concat(n),block:{blockText:"CommentPageSpecific"}},e.paginationZARef.current.trackEvent({eventType:"Click",elementLocation:Object.assign({type:"Button"},o)})},e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;e.trackPaginationClick(o,t),n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,a=o.order,c=o.status,r=o.parent,i=r.id,s=r.type,l=o.commentPattern,m=o.needLoadCommentPermission,u=o.loadComments;m&&e.loadCommentPermission(s,i),u(s,i,{order:a,isPrevious:!1,status:c,commentPattern:l,current:t})},e.renderComment=function(t){var n=t.id,o=t.featured?"".concat(n,"_featured"):n,a=!e.state.collapsed;return Object(l.b)("ul",{className:"NestComment",children:Object(l.b)(It,Object.assign({comment:t,commentStatus:e.props.parent.commentStatus,onReply:e.addComment,onFeature:e.featureItem,showCollapsed:a},e.props))},o)},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props,a=o.byComment,c=o.lastFeaturedIndex,r=o.parent,i=r.featuredCounts,s=r.commonCounts,m=[],u=i>0;return e.lastFeaturedIndex=0,t.length>0&&t.forEach((function(o,r){if(a||!o.collapsed){var d=t[r-1];o.collapsed&&(d&&d.collapsed||m.push(e.renderCollapsedDivider()),n)||(r===c&&m.push(Object(l.b)("div",{className:"NestComment-nextSiblings--noBorder"},"NestComment-nextSiblings--noBorder")),u&&0===r&&-1!==c&&m.push(Object(l.c)("div",{className:"CommentListV2-header-divider",children:["精选评论（",i,"）"]},"divider-featured")),m.push(e.renderComment(o)),r===c&&(e.lastFeaturedIndex=r,m.push(Object(l.c)("div",{className:"CommentListV2-header-divider",children:["评论（",s,"）"]},"divider-comment"))))}})),m},e.renderCollapsedComments=function(){var t=e.props,n=t.collapsedComments,o=t.isDrained,a=t.parent,c=(a=void 0===a?{}:a).collapsedCounts;return!o||c<=0?[]:n.map((function(t){return e.renderComment(t)}))},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(l.b)("div",{className:"CommentListV2-action",children:Object(l.c)("div",{className:"CommentListV2-expendCollapseButton",children:[Object(l.c)("span",{role:"button",tabIndex:0,onClick:e.handleOpenCollapsed,children:[Object(N.formatNumber)(o)," 条评论被折叠"]}),"（",Object(l.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})},"collapsed"):Object(l.c)("div",{className:"CommentListV2-divider",children:[Object(l.b)("div",{className:"CommentListV2-dividerLine"}),Object(l.c)("div",{className:"CommentListV2-dividerText",children:[Object(N.formatNumber)(o)," 条评论被折叠（",Object(l.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})]},"divider-collapsed")},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=void 0===n?{}:n,a=o.isFetching,c=void 0!==a&&a,r=o.isPrevDrained,i=void 0!==r&&r,s=o.isDrained,m=void 0!==s&&s;return Object(l.b)(R.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:c,isPrevDrained:i,isDrained:m,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(l.b)(R.a,{className:"CommentItem",small:!0}),children:e.renderCollapsedComments()})},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,a=n.parent.adminClosedComment,c=n.byComment,r=n.status,i=n.order,s=n.totals,m=n.showPackupButton,u=n.handlePackupButton,d=Math.ceil(s/20),p=e.state.current;return a?null:o?Object(l.b)(Fe.a,{}):Object(l.c)("div",{ref:e.commentsWithPaginationElRef,children:[Object(l.b)("div",{className:"CommentListV2",children:"normal"===i&&"open"===r?e.renderNormalComments(t):e.renderComments(t)}),d>1&&Object(l.c)(y.e,{zaType:"Block",zaBlock:"CommentPagination",children:[Object(l.b)(y.d,{ref:e.paginationZARef}),Object(l.b)(k.a,{className:"CommentsV2-pagination",current:p,total:d,onSelect:e.handlePageSelect})]}),!c&&e.renderCollapsedDivider(),!c&&e.renderCollapsedInfiLoader(),m&&Object(l.b)(qe.a,{onClick:u,commentsElRef:e.commentsWithPaginationElRef})]})},e.renderModalContent=function(t){var n=e.props,o=n.collapsedInfo,a=n.parent.adminClosedComment,c=n.status,r=n.order,i=n.byComment,s=e.state.collapsed,m=s?e.props:o,u=m.isFetching,d=void 0!==u&&u,p=m.isDrained,h=void 0!==p&&p,b=m.isPrevDrained,f=void 0!==b&&b;return h&&t.length<=0||a?Object(l.b)("div",{className:"CommentsV2-empty",children:Object(l.c)(T.d,{children:[Object(l.b)(T.a,{}),Object(l.b)("div",{children:"还没有评论"})]})}):Object(l.c)(R.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isPrevDrained:f,isDrained:h,onLoad:function(t){return e.load(e.props,t,!s)},placeholder:Object(l.b)(R.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:["normal"===r&&"open"===c?e.renderNormalComments(t):e.renderComments(t),!i&&e.renderCollapsedDivider(),!i&&e.renderCollapsedComments()]})},e.renderCommentEdit=function(){var t,n=e.props,o=n.parent,a=o.canComment,c=(a=void 0===a?{status:!0}:a).status,r=a.reason,i=o.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,m=o.type,u=o.id,d=o.adminClosedComment,p=o.commentStatus,h=o.questionType,b=o.brand,f=o.question,v=n.byComment,O=n.autoFocus,j=n.commentNeedsReview,g=n.zaInfo,y=n.showNotification,R=d?"当前内容暂时无法评论":r,k=O&&!v,N=p&&!1===p.canComment,I=null!==(t=Object(ut.a)(m,f,b))&&void 0!==t?t:"";return c&&!d?Object(l.c)("div",{className:"CommentsV2-footer-wrapper",children:[Object(l.b)(Ve,{className:"CommentsV2-footer",type:m,id:u,commentNeedsReview:j,commentStatus:p,onSubmit:e.addComment,autoFocus:k,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===h,zaInfo:g,brandCommentText:I}),N&&Object(l.b)("div",Object.assign({},Object(B.a)((function(){y(p.toast,"red")}),{className:"CommentsV2-footer-disabled"})))]}):Object(l.b)("div",{className:C()("CommentsV2-disabledText"),children:Object(l.b)("div",{className:"CommentsV2-disabledReason",children:R})})},e}return Object(c.a)(n,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,a=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return a(t);default:return null}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,a=e.loadStickers,c=e.getCommentWithPicPermission,r=e.commentWithPicPermission,i=e.currentUser;n||"bottom"!==t||this.loadByPagination(this.state.current),!o.length&&a(),void 0===r.commentWithPic&&i&&c()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,c=t.commentPattern;n===e.order&&o===e.status||("bottom"===c?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var r=e.targetComment;r!==a&&r&&this.setState({collapsed:r.collapsed})}},{key:"componentWillUnmount",value:function(){Object(I.d)(I.b)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.comments,a=t.commentPattern,c=t.commentInputPosition,r=t.isAuthor,i=t.parent,s=i.author,m=(s=void 0===s?{isOrg:!1}:s).isOrg,u=i.commentPermission,d=i.reviewingCounts,p=i.commentCount,h=i.adminClosedComment,b=t.totals,f=t.status,v=t.order,O=t.onStatusChange,j=t.onOrderChange,g=t.targetLink,y=t.shouldReverse,R=t.permission.canBrandAdminEdit,k="censor"===u&&(r||R),N=k?{isCommentReviewer:k,onStatusChange:O,status:f,reviewingCounts:d}:{status:f};return Object(l.c)("div",{className:C()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t},children:[Object(l.b)(_e.a,Object.assign({commentCount:void 0!==p?p:b,shouldReverse:y,commentClosed:h,targetLink:g,order:v,onOrderChange:j,commentPattern:a,isOrg:m},N)),"top"===c&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(o):this.renderModalContent(o),"bottom"===c&&this.renderCommentEdit()]})}}]),n}(m.Component);Pt.propTypes={type:p.a.string,parent:p.a.object.isRequired,targetLink:p.a.node,commentNeedsReview:p.a.bool,byComment:p.a.oneOfType([p.a.number,p.a.string]),commentPattern:p.a.string,commentInputPosition:p.a.oneOf(["top","bottom"]),showPackupButton:p.a.bool,handlePackupButton:p.a.func,onPaginationClick:p.a.func,autoFocus:p.a.bool,shouldReverse:p.a.bool},Pt.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0};var Et=Object(f.compose)(Object(b.connect)((function(e,t){var n=t.parent,o=t.parent,a=o.type,c=o.id,r=t.status,i=t.order,s=t.byComment,l=t.commentPattern,m=t.notificationId,u=e.entities,d=e.commentsV2,p=d.conversation,h=d.stickers,b=void 0===h?[]:h,f=d.commentWithPicPermission,v=d.notificationsComments,C=d.parent,O=u.comments[s],j=d.pagination;"reviewing"===r&&(j=d.reviewing);var y="reverse"===i&&"open"===r;y&&(j=d.reverse);var R="".concat(a,"_").concat(c),k=[],N=d.collapsed[R]||{};N.ids&&N.ids.length>0&&(k=N.ids.map((function(e){return u.comments[e]}))),m&&(j=v,R=m);var I=j[R]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},w=I.isFetching,S=I.isPrevDrained,B=I.isDrained,T=I.ids,x=I.newIds,L=void 0===x?[]:x,A=I.totals,M="bottom"!==l?T:L,D=M.map((function(e){return u.comments[e]})).map(z),V=g()(M,(function(e){return String(e).includes("_featured")}));return{currentUser:Object(P.b)(e),isFetching:w,isPrevDrained:S,isDrained:B,totals:m?D.length:A,collapsedInfo:N,collapsedComments:k,targetComment:O,conversation:p,entities:u,stickers:b,lastFeaturedIndex:V,comments:D,isReverseAndStatusOpen:y,commentWithPicPermission:f,ids:M,parent:Object.assign(Object.assign({},n),C[R]),permission:Object(E.n)(e)}}),{loadComments:O.g,loadConversation:O.h,addComment:O.a,loadStickers:O.k,showNotification:I.g,clearNotification:I.d,getCommentWithPicPermission:O.f,loadNotificationComments:O.j,loadAnswerCommentPermission:w.k,loadArticleCommentPermission:S.c}),Object(x.a)())(Pt),Bt=n(160),Tt=n.n(Bt),xt=n(235),Lt=n.n(xt),zt=n(884);function At(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Mt=function(e){Object(r.a)(n,e);var t=At(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).load=function(){var t=e.props,n=t.isAnchorComments,o=t.conversationId;(0,t.loadConversation)({id:o,isAnchorComments:n})},e.addComment=function(t,n,o){var a=o.rootCommentId,c=o.isConversation,r=e.props,i=r.parent,s=i.type,l=i.id,m=r.conversationId,u=r.addComment,d=r.isAnchorComments;return u({parentType:s,parentId:l,content:t,replyTo:n,conversationId:m,rootCommentId:a,isConversation:c,replyType:wt({id:a,replyTo:n,isConversation:c}).type,isAnchorComments:d})},e.loadMoreAnchorComments=function(){var t=e.props,n=t.conversationId,o=t.topCommentsPaging,a=void 0===o?{}:o;(0,t.loadMoreAnchorComments)({conversationId:n,nextUrl:a.next})},e.createOnRef=Tt()((function(t){return function(n){var o=e.props.byComment;n&&o&&String(t)===String(o)&&(e.byCommentNode=n)}})),e.scrollToTarget=function(){var t=Object(D.a)(e),n=t.byCommentNode,o=t.listEl;if(o&&n){var a=n.getBoundingClientRect(),c=a.top,r=a.height,i=o.getBoundingClientRect(),s=i.top,l=i.height;e.listEl.scrollTop+=c-s-(l-r)/2,n.classList.add("CommentItemV2--highlighted"),setTimeout((function(){return n.classList.remove("CommentItemV2--highlighted")}),2e3),n.tabIndex=-1,n.focus()}},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,a=t.onItemFeature,c=t.onItemApprove,r=t.onItemCollapse,i=t.onItemDislike,s=t.onNavBack,u=t.canOperateItem,d=t.isFetching,p=t.comments,h=void 0===p?[]:p,b=t.commentNeedsReview,f=t.openComment.collapsed,v=t.parent,C=t.commentPattern,O=t.totals,j=t.isDrained,g=t.isPrevDrained,y=t.isConversationMoreFetching,k=t.isConversationMoreDrained,N=t.offsetIndex,I=null;return d&&!h.length?I=Object(l.c)(l.a,{children:[Object(l.b)(R.a,{className:"CommentItemV2",small:!0}),Object(l.b)("div",{className:"CommentsV2-openComment-divider"}),Object(l.b)("div",{className:"CommentsV2-replyNum",children:"".concat(O," 条回复")})]}):h.length&&(I=h.map((function(t,s){return s?k||s!==N||y?y&&s===N?Object(l.c)(m.Fragment,{children:[Object(l.b)(jt,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:c,onCollapse:r,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id),Object(l.b)(R.a,{className:"NestCoomment-moreCommentButton ",small:!0},"NestCoomment-moreCommentButton-PlaceHolder")]},t.id):Object(l.b)(jt,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:c,onCollapse:r,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id):Object(l.c)(m.Fragment,{children:[Object(l.b)(jt,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:c,onCollapse:r,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id),Object(l.c)("div",{role:"button",tabIndex:0,preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments,children:[Object(l.b)(zt.a,{}),Object(l.b)("p",{children:"点击查看更多回复"})]},"NestCoomment-moreCommentButton")]},t.id):Object(l.c)(m.Fragment,{children:[Object(l.b)("div",{className:"CommentsV2-openComment",children:Object(l.b)(jt,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:c,onCollapse:r,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id)}),Object(l.b)("div",{className:"CommentsV2-openComment-divider"}),Object(l.b)("div",{children:Object(l.b)("div",{className:"CommentsV2-replyNum",children:"".concat(O," 条回复")})},"".concat(t.id,"-title"))]},t.id)}))),"bottom"===C?Object(l.b)(Ie.b,{size:"fullPage",onClose:s,children:Object(l.c)("div",{className:"CommentsV2",children:[Object(l.b)(_e.a,{isConversation:!0,commentPattern:C}),Object(l.b)(R.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(l.b)(R.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:I})]})}):Object(l.c)("div",{className:"CommentsV2",children:[Object(l.b)(_e.a,{isConversation:!0,onNavBack:s}),Object(l.b)(R.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(l.b)(R.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:I})]})}}]),n}(m.Component);Mt.propTypes={conversationId:p.a.oneOfType([p.a.number,p.a.string]),type:p.a.string,parent:p.a.object.isRequired,commentNeedsReview:p.a.bool};var Dt=Object(f.compose)(Object(b.connect)((function(e,t){var n=t.conversationId,o=t.isAnchorComments,a=e.entities.comments,c=e.commentsV2,r=c.conversation,i=c.conversationMore,s=r[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=s.isFetching,m=s.isDrained,u=s.isPrevDrained,d=s.ids,p=s.totals,h=s.topComments,b=(h=void 0===h?{}:h).paging,f=(b||{}).isEnd,v=i[n]||{isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isDrained,j=v.ids,g=j.map((function(e){return a[e]})),y=d.map((function(e){return a[e]})),R=a["".concat(n,"_featured")]||a[n]||{};return{isFetching:l,isDrained:m,isPrevDrained:u,totals:p,comments:o?Lt()(j.length?[].concat(Object(M.a)(y.slice(0,4)),Object(M.a)(g),Object(M.a)(y.slice(4))):y,"id"):[R].concat(Object(M.a)(y)),openComment:R,topCommentsPaging:b,isConversationMoreFetching:C,isConversationMoreDrained:f||O,offsetIndex:b?[].concat(Object(M.a)(y.slice(0,3)),Object(M.a)(g)).length:-1}}),{loadConversation:O.h,addComment:O.a,loadMoreAnchorComments:O.i}))(Mt),Vt=n(108),Ft=n(148),_t=["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission","currentUser"];function qt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Ut=function(e){Object(r.a)(n,e);var t=qt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,c=new Array(o),r=0;r<o;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={openedCommentId:e.props.byComment,isAnchorComments:Boolean(e.props.byComment),status:"open",order:"normal"},e.commentsContainerRef=Object(m.createRef)(),e.showConversation=function(t){var n=t.commentId,o=t.isAnchorComments;e.setState({openedCommentId:n,isAnchorComments:o})},e.showComments=function(){var t=e.props,n=t.byComment,o=t.router;n&&o.replace("".concat(location.pathname).concat(location.search)),e.setState({openedCommentId:null,isAnchorComments:!1})},e.delete=function(t){var n=e.props,o=n.parent;return(0,n.deleteComment)(t,o.type,o.id)},e.feature=function(t){var n=e.props,o=n.parent,a=n.updateCommentFeatureStatus,c=n.notificationId;a({id:e.state.openedCommentId,commentId:t,parentId:o.id,parentType:o.type,notificationId:c})},e.like=function(t,n){var o=e.props,a=o.onItemLike,c=o.updateCommentLikeStatus;a&&a(t,n),c(t)},e.collapse=function(t){var n=e.props,o=n.parent;(0,n.updateCommentCollapsed)(t,o.type,o.id)},e.dislike=function(t){(0,e.props.updateCommentDisliked)(t)},e.approve=function(t){var n=e.props,o=n.parent,a=n.type;(0,n.approveComment)(t,o.type||a,o.id)},e.reject=function(t){var n=e.props,o=n.parent,a=n.type;(0,n.rejectComment)(t,o.type||a,o.id)},e.handleStatusChange=function(t){e.setState({status:t})},e.handleOrderChange=function(t,n){var o=e.props.onOrderChange;o&&o(t,n),e.setState({order:t})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerRef.current)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.containerClassName,a=e.parent,c=e.commentPattern,r=e.type,i=e.parent,s=(i=void 0===i?{}:i).commentPermission,m=i.relationship,u=void 0===m?{}:m,d=i.author,p=void 0===d?{}:d,h=e.needLoadCommentPermission,b=e.currentUser,f=Object(o.default)(e,_t),v="string"==typeof p?p:p.urlToken,O=void 0===u.isAuthor?b&&v&&b.urlToken===v:u.isAuthor,j="censor"===s&&!O,g="answer"===r||"article"===r,y=this.state,R=y.openedCommentId,k=y.isAnchorComments,N=y.status,I=y.order,w=R,S=Boolean(R&&"bottom"!==c);return Object(l.c)("div",{className:C()("Comments-container",n),ref:this.commentsContainerRef,children:[Object(l.b)(Et,Object.assign(Object.assign({className:C()(t,{"CommentsV2--hidden":S})},f),{},{type:r,order:I,status:N,parent:a,commentPattern:c,commentNeedsReview:j,canOperateItem:g,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:w,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:h,isAuthor:O})),R&&Object(l.b)(Dt,Object.assign(Object.assign({},f),{},{parent:a,type:r,canOperateItem:g,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:c,conversationId:R,onNavBack:this.showComments,byComment:w,isAnchorComments:k,commentNeedsReview:j,onShowConversation:this.showConversation}))]})}}]),n}(m.Component);Ut.propTypes={type:p.a.string.isRequired,parent:p.a.object.isRequired,onOrderChange:p.a.func,onItemLike:p.a.func,isAuthor:p.a.bool,onMount:p.a.func},Ut.defaultProps={type:"answer"};t.default=Object(f.compose)(Object(Vt.a)(null),h.withRouter,Ft.a,Object(b.connect)(null,{updateCommentLikeStatus:O.p,updateCommentFeatureStatus:O.o,deleteComment:O.e,updateCommentCollapsed:O.m,updateCommentDisliked:O.n,approveComment:O.b,rejectComment:O.l}))(Ut)},1777:function(e,t,n){"use strict";n.r(t);var o,a=n(27),c=n(10),r=n(11),i=n(13),s=n(14),l=n(6),m=n(0),u=n(2),d=n.n(u),p=n(26),h=n(1),b=n(12),f=n(7),v=n.n(f),C=n(191),O=n(16),j=n(9),g=n(160),y=n.n(g),R=n(1268),k=n(122),N=n(125),I=n(1490),w=n(18),S=n(48),P=n(149),E=n(1369),B=n(38),T=n(65),x=n(171),L=n(1341),z=n(99),A=n(15),M=n(66),D=n(61),V=n(100),F=n.n(V),_=n(46),q=n.n(_),U=n(71),H=n(28),G=n(85),W=n(143),Z=n(392),K=n(44);function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var J=function(){return""},X=function(e){Object(i.a)(n,e);var t=Y(n);function n(e){var o;return Object(c.a)(this,n),(o=t.call(this,e)).initLocalComment=function(){var e=o.props,t=e.type,n=e.id;if(t&&n){var a=q.a.get("zhihu::comment_local_key")||[],c="".concat(t,"_").concat(n),r=a.find((function(e){return e.key===c})),i=r&&r.value;i&&o.setState({value:{toHTML:function(){return i}},hasNoContent:!1})}},o.saveLocalComment=function(e){var t=o.props,n=t.type,a=t.id;if(n&&a){var c=e?e.toHTML():o.state.value.toHTML(),r="".concat(n,"_").concat(a),i=(q.a.get("zhihu::comment_local_key")||[]).filter((function(e){return e.key!==r})),s=c?[].concat(Object(A.a)(i.slice(0,4)),[{key:r,value:c}]):i;q.a.set("zhihu::comment_local_key",s)}},o.handleChange=function(e){o.setState({value:e,hasNoContent:e.isEmpty})},o.handleCommentShow=o.props.authRequired((function(){o.setState({shown:!0}),o.hiddenInput.focus()})),o.handleCommentHide=function(){o.setState({shown:!1})},o.handleMobileComment=function(){o.onSubmit(),o.handleCommentHide()},o.focusInput=function(e){e.preventDefault(),o.input.focus()},o.onChange=o.handleChange.bind(Object(M.a)(o)),o.onFocus=o.handleFocus.bind(Object(M.a)(o)),o.onBlur=o.handleBlur.bind(Object(M.a)(o)),o.onSubmit=o.props.authRequired(o.handleSubmit.bind(Object(M.a)(o)),void 0,B.b),o.state={active:e.defaultActive,hasNoContent:!0,submitting:!1,shown:!1,value:{toHTML:J}},o}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.initLocalComment()}},{key:"componentWillUnmount",value:function(){this.saveLocalComment()}},{key:"handleFocus",value:function(){this.setState({active:!0})}},{key:"handleBlur",value:function(){var e=this;setTimeout((function(){return e.setState({active:!1})}),100)}},{key:"handleSubmit",value:function(){var e=this,t=this.props,n=t.replyTo,o=t.onSubmit,a=t.onCancel,c=this.state.submitting,r=this.input.toHTML();if(r&&o&&!c){this.setState({submitting:!0}),this.saveLocalComment();var i=o(r,n);i.then?i.then((function(){a&&a(),e.input?(e.input.reset(),e.setState({value:{toHTML:J}},(function(){return e.saveLocalComment()}))):e.saveLocalComment({toHTML:J})})).finally((function(){e.setState({submitting:!1})})):(this.setState({submitting:!1}),a&&a(),this.input.reset()),O.a.trackEvent(this,{action:"Comment",element:"Button"})}}},{key:"renderInput",value:function(e){var t=this,n=e.placeholder,o=e.className,a=this.props.autoFocus;return Object(m.c)(h.Fragment,{children:[Object(m.b)(W.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:this.focusInput}}),Object(m.b)(Z.a,{className:v()("CommentEditor-input",o),defaultValue:this.state.value.toHTML(),allowMention:!0,allowPasteRichText:!1,autoFocus:Boolean(void 0)||a,outputBlockType:"div",ref:function(e){t.input=e},placeholder:n,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,onSubmit:this.onSubmit,minRows:5})]})}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,a=e.className,c=(e.onClick,e.onCancel),r=e.ownerAuthorIsOrg,i=e.ownerAuthorIsBrand,s=(e.type,e.id,e.shouldOia,e.preset,e.brandCommentText),l=void 0===s?"":s,u=e.commentStatus,d=this.state,p=d.active,h=d.hasNoContent,b=d.submitting,f=r?"机构":"作者",C={preset:"primary",color:"blue",children:"评论",disabled:h||b};if(t){var O=F()(o||(o=Object(z.a)(["回复","",""])),t.author.member.name,n?"，评论由".concat(f,"筛选后公开"):"");return Object(m.c)("div",{className:v()(a,"CommentEditor--inCommentItem",{"CommentEditor--active":p||!h}),children:[this.renderInput({placeholder:O}),Object(m.c)("div",{className:"CommentEditor-actions",children:[Object(m.b)(w.c,{preset:"plain",onClick:c,children:"取消"}),Object(m.b)(w.c,Object.assign(Object.assign({},C),{},{onClick:this.onSubmit}))]})]})}var j="写下你的评论...";n&&(j=i&&l?l:r?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),u&&!1===u.canComment&&(j=u.toast);v()(a,"CommentEditor--normal"),this.state.shown;return Object(m.c)("div",{className:v()(a,"CommentEditor--normal",{"CommentEditor--active":p||!h}),children:[this.renderInput({placeholder:j}),Object(m.b)(w.c,Object.assign(Object.assign({},C),{},{className:"CommentEditor-singleButton",onClick:this.onSubmit}))]})}}]),n}(h.Component);X.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1},X.propTypes={className:d.a.string,defaultActive:d.a.bool,replyTo:d.a.object,inCommentItem:d.a.bool,commentNeedsReview:d.a.bool,canComment:d.a.object,onCancel:d.a.func,onSubmit:d.a.func.isRequired};var Q=Object(p.compose)(D.withRouter,G.a,Object(b.connect)((function(e){return{shouldOia:Object(K.i)(e)}})))(X),$=(n(1273),n(1504)),ee=n(1300),te=n(1293),ne=n(1297),oe=n(1263),ae=n(1758),ce=n(1248),re=n(1298),ie=n(1264),se=(n(57),n(400),n(76)),le=n(394),me=n(493),ue=n(491),de=n(178),pe=n(711),he=n(224),be=n(225);function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var ve=function(e){Object(i.a)(n,e);var t=fe(n);function n(){var e;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1},e.getRedirectUrl=function(){var t=e.props.parent;switch(t.type){case"answer":return"/question/".concat(t.question.id,"/answer/").concat(t.id);case"article":return"https://zhuanlan.zhihu.com/p/".concat(t.id);default:return""}},e.like=e.props.authRequired((function(t){var n=e.props;(0,n.onLike)(n.comment.id,t)}),H.M.like,B.b),e.dislike=e.props.authRequired((function(){var t=e.props;(0,t.onDislike)(t.comment.id)}),H.M.like,B.b),e.delete=function(){var t=e.props;(0,t.onDelete)(t.comment.id)},e.feature=function(){var t=e.props;(0,t.onFeature)(t.comment.id)},e.collapse=function(){var t=e.props;(0,t.onCollapse)(t.comment.id)},e.approve=function(){var t=e.props;(0,t.onApprove)(t.comment.id)},e.showConversation=function(){var t=e.props;(0,t.onShowConversation)(t.comment.id)},e.startReply=e.props.authRequired((function(){var t=e.props,n=t.commentStatus,o=t.showNotification;n&&!1===n.canReply?o(n.toast,"red",B.b):e.setState({isReplying:!0})}),void 0,B.b),e.stopReply=function(){e.setState({isReplying:!1})},e.openReportModal=e.props.authRequired((function(){e.setState({reportModalShown:!0})})),e.closeReportModal=function(t){if(t){var n=t.result.payload,o=n&&n.message||n&&n.code&&"举报失败";t.commentDeleteResult&&!(t.commentDeleteResult.payload||{}).code?le.b.showModal({reportText:o}):Object(de.b)(o||"举报成功")}e.setState({reportModalShown:!1})},e.handleExpand=function(){e.setState({collapsed:!1})},e.handleToggleGuide=function(){e.setState({guideShown:!e.state.guideShown})},e.handleDelete=function(){return e.setState({deleteModal:!0})},e.handleCloseDelete=function(){return e.setState({deleteModal:!1})},e}return Object(r.a)(n,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:Object(m.b)("span",{className:"CommentItem-roleInfo",children:"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) "})}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=void 0===o?{}:o,c=t.role;return Object(m.c)("span",{children:[Object(m.b)("span",{className:"CommentItem-reply",children:"回复"}),Object(m.b)(ue.a,{className:v()({"CommentItem-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:a}),this.renderRoleInfo(c,n)]})}},{key:"renderInner",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,a=n.collapsed,c=t.isConversation,r=t.ownerAuthorIsOrg;if(o)return c?Object(m.b)("div",{className:"CommentItem-deletedContent",children:"这里有一条已删除的评论"}):null;if(a&&c&&this.state.collapsed)return Object(m.c)("div",{className:"CommentItem-deletedContent",children:["这里有一条已折叠的评论，",Object(m.b)(w.c,{preset:"plain",onClick:this.handleExpand,children:"查看"})]});var i,s=this.state,l=s.reportModalShown,u=s.isReplying,d=this.props,p=d.parent,h=p.canComment,b=(h=void 0===h?{status:!0}:h).status,f=p.questionType,C=d.commentNeedsReview,O=d.comment,j=d.onReply,g=d.status,y=d.type,R=d.canOperate,k=d.commentPattern,N=d.isMobile,I=O.id,S=O.author,P=O.content,E=O.voteCount,B=O.replyToAuthor,T=O.isAuthor,x=O.isParentAuthor,L=O.createdTime,z=O.featured,A=O.voting,M=O.reviewing,D=O.disliked,V=O.resourceType,F=O.collapsedReason,_=void 0===F?"":F,q=S||{},U=q.member,H=q.role;if(u)i=Object(m.b)(Q,{type:"comment",id:I,commentNeedsReview:C,className:"CommentItem-editor",defaultActive:!0,replyTo:O,onCancel:this.stopReply,onSubmit:j});else if("reviewing"===g)i=Object(m.c)("div",{className:"CommentItem-footer",children:[Object(m.c)(w.c,{preset:"plain",onClick:this.approve,children:[Object(m.b)($.a,{style:{marginRight:5},center:!0,size:14}),"公开"]}),Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.handleDelete,children:[Object(m.b)(ee.a,{style:{marginRight:5},center:!0,size:16}),"删除"]})]});else{var G=T||x&&("question"!==y||"commercial"===f);i=Object(m.c)("div",{className:v()("CommentItem-footer",{"CommentItem-mobileFooter":void 0}),children:[Object(m.c)(w.c,{className:v()("CommentItem-likeBtn",A&&"is-liked"),preset:"plain",onClick:this.like,disabled:T||!b,children:[Object(m.b)(te.a,{style:{marginRight:5},center:!0,size:16}),E>0?E:"赞"]}),a&&_&&Object(m.c)("div",{className:"CommentItem-walleTag",children:["阴阳怪气自动折叠"===_&&Object(m.b)(ne.a,{size:16,className:"CommentItem-walleIcon"}),_]}),!c&&B&&Object(m.c)(w.c,{preset:"plain",className:"CommentItem-talkBtn",onClick:this.showConversation,children:[Object(m.b)(oe.a,{style:{marginRight:5},center:!0,size:16}),"查看对话"]}),!c&&!T&&b&&!a&&Object(m.c)(w.c,{preset:"plain",className:v()({"CommentItem-hoverBtn":!0}),onClick:this.startReply,children:[Object(m.b)(ae.a,{style:{marginRight:5},center:!0,size:16}),"回复"]}),x&&R&&!N&&Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!T}),preset:"plain",onClick:this.feature,children:[Object(m.b)(ce.a,{style:{marginRight:5},center:!0,size:16}),z?"取消推荐":"推荐"]}),x&&R&&!N&&Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!T}),preset:"plain",onClick:this.collapse,children:[Object(m.b)(re.a,{style:{marginRight:5},center:!0,size:14}),a?"取消折叠":"折叠"]}),!x&&!T&&R&&!N&&Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.dislike,children:[Object(m.b)(te.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),D?"取消踩":"踩"]}),T||Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.openReportModal,children:[Object(m.b)(ie.a,{style:{marginRight:5},center:!0,size:16}),"举报"]}),G&&Object(m.c)(w.c,{className:v()({"CommentItem-hoverBtn":!T}),preset:"plain",onClick:this.handleDelete,children:[Object(m.b)(ee.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),void 0,void 0,Object(m.b)(le.a,{shown:this.state.deleteModal,id:I,onDelete:this.delete,onClose:this.handleCloseDelete}),Object(m.b)(he.a,Object.assign(Object.assign({type:"comment",urlToken:I,shown:l,onClose:this.closeReportModal},G&&{onDeleteComment:function(){return e.props.onDelete(I)}}),{},{notification:{failure:pe.a},zaEnabled:!0}))]})}return Object(m.c)("div",{children:[Object(m.c)("div",{className:"CommentItem-meta",children:[U&&Object(m.b)(me.a,{className:"CommentItem-avatar",noHoverCard:"fixed"===k,user:U}),U&&Object(m.b)(ue.a,{className:v()({"CommentItem-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:U}),this.renderRoleInfo(H,V),this.renderReplyTo(),M&&Object(m.b)(re.a,{className:"CommentItem-reviewing","data-tooltip":"".concat(!1===r?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),"aria-label":"".concat(!1===r?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),Object(m.b)("span",{className:"CommentItem-time",children:Object(se.toRelativeString)(L)})]}),Object(m.b)(be.a,{className:"CommentItem-content",html:P}),i]})}},{key:"render",value:function(){var e=this.renderInner(),t=this.props,n=t.parent;n.type,n.id,t.isWechat;return e&&Object(m.c)("div",{className:"CommentItem",ref:this.props.onRef,children:[e,void 0]})}}]),n}(h.PureComponent);ve.propTypes={comment:d.a.object.isRequired,parent:d.a.object.isRequired,commentNeedsReview:d.a.bool,type:d.a.string,isConversation:d.a.bool,onLike:d.a.func.isRequired,onShowConversation:d.a.func,onReply:d.a.func,onFeature:d.a.func,onDelete:d.a.func.isRequired,onCollapse:d.a.func,commentPattern:d.a.string,isMobile:d.a.bool};var Ce=Object(p.compose)(D.withRouter,G.a,Object(b.connect)((function(e){return{isWechat:e.env.userAgent.Wechat,shouldSpecialOia:Object(K.j)(e)}}),{showNotification:B.g}))(ve),Oe=n(1493),je=n(1395),ge=n(1494),ye=n(1423);function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}function ke(e,t){switch(e){case"answer":return Object(T.k)(t);case"article":return Object(x.c)(t);default:return null}}var Ne=function(e){Object(i.a)(n,e);var t=Re(n);function n(){var e;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=Object(h.createRef)(),e.paginationZARef=Object(h.createRef)(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var a=t||e.props,c=a.order,r=a.byComment,i=a.status,s=a.parent,l=s.id,m=s.type,u=a.dispatch,d=a.commentPattern;if(a.needLoadCommentPermission&&ke(m,l)&&u(ke(m,l)),o){u(Object(C.e)(m,l,{order:c,isPrevious:n,byComment:r,status:"collapsed",commentPattern:d},!0))}else u(Object(C.e)(m,l,{order:c,isPrevious:n,byComment:r,status:i,commentPattern:d}))}},e.addComment=function(t,n){var o=e.props,a=o.parent,c=a.id,r=a.type,i=o.dispatch,s=[r,c,t];return n&&(s[3]=n.id),i(C.a.apply(void 0,s))},e.featureItem=function(t){e.props.onItemFeature(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.createOnRef=y()((function(t){return function(n){var o=e.props.byComment;t===Number(o)&&(e.targetCommentEl=n)}})),e.trackPaginationClick=function(t,n){var o;o=n===t+1?{text:"下一页",block:{blockText:"CommentPageNext"}}:n===t-1?{text:"上一页",block:{blockText:"CommentPageBefore"}}:{text:"".concat(n),block:{blockText:"CommentPageSpecific"}},e.paginationZARef.current.trackEvent({eventType:"Click",elementLocation:Object.assign({type:"Button"},o)})},e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;e.trackPaginationClick(o,t),n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,a=o.order,c=o.byComment,r=o.status,i=o.parent,s=i.id,l=i.type,m=o.dispatch,u=o.commentPattern;o.needLoadCommentPermission&&ke(l,s)&&m(ke(l,s)),m(Object(C.e)(l,s,{order:a,isPrevious:!1,byComment:c,status:r,commentPattern:u,current:t}))},e.renderComment=function(t){var n=e.props,o=n.parent,a=o.type,c=o.author,r=(c=void 0===c?{isOrg:!1}:c).isOrg,i=n.isMobile,s=n.parent,l=n.commentNeedsReview,u=n.onShowConversation,d=n.status,p=n.onItemLike,h=n.onItemDelete,b=n.onItemCollapse,f=n.onItemDislike,v=n.onItemApprove,C=n.canOperateItem,O=n.commentPattern;return Object(m.b)(Ce,{isMobile:i,comment:t,onRef:e.createOnRef(t.id),status:d,type:a,parent:s,canOperate:C,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:r,onLike:p,onReply:e.addComment,onFeature:e.featureItem,onDelete:h,onCollapse:b,onDislike:f,onApprove:v,commentPattern:O,commentStatus:s.commentStatus},t.id)},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props.byComment,a=[];if(e.lastFeaturedIndex=0,t.length>0){var c=t[0].featured,r=!1;t.forEach((function(i,s){if(o||!i.collapsed){var l=t[s-1];if(!i.collapsed||(l&&l.collapsed||a.push(e.renderCollapsedDivider()),!n)){a.push(e.renderComment(i));var u=t[s+1];c&&!r&&i.featured&&(!u||!u.featured)&&(r=!0,e.lastFeaturedIndex=s,a.push(Object(m.c)("div",{className:"CommentList-divider",children:[Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.c)("div",{className:"CommentList-dividerText",children:["以上为精选评论",Object(m.b)(R.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论","aria-label":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})]})]},"divider-featured")))}}}))}return a},e.renderCollapsedComments=function(){var t=[],n=e.props.collapsedComments;return e.state.collapsed||!n||n.length<=0?[]:(t.push(n.map((function(t){return e.renderComment(t)}))),t)},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(m.b)("div",{className:"CommentList-action",children:Object(m.c)("div",{className:"CommentList-expendCollapseButton",children:[Object(m.c)("span",{role:"button",tabIndex:0,onClick:e.handleOpenCollapsed,children:[Object(S.formatNumber)(o)," 条评论被折叠"]}),"（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})},"collapsed"):Object(m.c)("div",{className:"CommentList-divider",children:[Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.c)("div",{className:"CommentList-dividerText",children:[Object(S.formatNumber)(o)," 条评论被折叠（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})]},"divider-collapsed")},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=(n=void 0===n?{}:n).isFetching,a=n.isPrevDrained,c=n.isDrained;return Object(m.b)(N.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:c,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(m.b)(N.a,{className:"CommentItem",small:!0}),children:e.renderCollapsedComments()})},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,a=n.parent.adminClosedComment,c=n.byComment,r=n.status,i=n.order,s=n.totals,l=n.showPackupButton,u=n.handlePackupButton,d=Math.ceil(s/20),p=e.state.current;return a?null:o?Object(m.b)(Oe.a,{}):Object(m.c)("div",{ref:e.commentsWithPaginationElRef,children:[Object(m.b)("div",{className:"CommentList",children:"normal"===i&&"open"===r?e.renderNormalComments(t):e.renderComments(t)}),d>1&&Object(m.c)(j.e,{zaType:"Block",zaBlock:"CommentPagination",children:[Object(m.b)(j.d,{ref:e.paginationZARef}),Object(m.b)(I.a,{className:"comments-pagination",current:p,total:d,onSelect:e.handlePageSelect})]}),!c&&e.renderCollapsedDivider(),!c&&e.renderCollapsedInfiLoader(),l&&Object(m.b)(ge.a,{onClick:u,commentsElRef:e.commentsWithPaginationElRef})]})},e.renderModalContent=function(t){var n=e.props,o=n.collapsedInfo,a=n.parent.adminClosedComment,c=n.status,r=n.order,i=n.byComment,s=e.state.collapsed,l=s?e.props:o,u=l.isFetching,d=l.isDrained,p=l.isPrevDrained;if(d&&t.length<=0||a)return Object(m.b)("div",{className:"Comments-empty",children:Object(m.c)(L.d,{children:[Object(m.b)(L.a,{}),Object(m.b)("div",{children:"还没有评论"})]})});var h={getContainer:function(e){return e}};return Object(m.c)(N.b,Object.assign(Object.assign({className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:d,onLoad:function(t){return e.load(e.props,t,!s)},placeholder:Object(m.b)(N.a,{className:"CommentItem",small:!0})},h),{},{children:["normal"===r&&"open"===c?e.renderNormalComments(t):e.renderComments(t),!i&&e.renderCollapsedDivider(),!i&&e.renderCollapsedComments()]}))},e.renderCommentEdit=function(t){var n,o=e.props,a=o.parent,c=a.canComment,r=(c=void 0===c?{status:!0}:c).status,i=c.reason,s=a.author,l=(s=void 0===s?{isOrg:!1}:s).isOrg,u=a.type,d=a.id,p=a.adminClosedComment,h=a.questionType,b=a.commentStatus,f=a.question,C=a.brand,j=o.byComment,g=o.autoFocus,y=o.commentNeedsReview,R=o.showNotification,k=p?"当前内容暂时无法评论":i,N=g&&!j,I=b&&!1===b.canComment,w=null!==(n=Object(ye.a)(u,f,C))&&void 0!==n?n:"";return r&&!p?Object(m.c)("div",{className:"Comments-footer-wrapper",children:[Object(m.b)(Q,Object.assign({className:"Comments-".concat("top"===t?"top":"footer"),type:u,id:d,commentNeedsReview:y,commentStatus:b,onSubmit:e.addComment,autoFocus:N,ownerAuthorIsOrg:l,ownerAuthorIsBrand:"commercial"===h,brandCommentText:w},"top"===t&&{preset:"default",onClick:function(e){O.a.trackEvent(e.target,{id:3905})}})),I&&Object(m.b)("div",Object.assign({},Object(E.a)((function(){R(b.toast,"red",B.b)}),{className:"Comments-footer-disabled"})))]}):"top"!==t&&Object(m.b)("div",{className:v()("Comments-disabledText",{"Comments-disabledText--fixed":void 0}),children:Object(m.b)("div",{className:"Comments-disabledReason",children:k})})},e.renderBottomButton=function(){var t=e.props.params,n=t.id,o=t.answerId,a=Boolean(o);return Object(m.b)("div",{className:"Comments-footer CommentEditor--normal",children:Object(m.b)(w.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(k.e)(Object(P.a)(a?{type:"answer",id:o}:{type:"question",id:n},{utm_content:"comment_area"}),{zaProps:{id:3906}})},children:"打开 App 参与站内讨论"})})},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,a=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||this.loadByPagination(a)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,c=t.commentPattern;n===e.order&&o===e.status||("bottom"===c?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var r=e.targetComment;!a&&r&&this.setState({collapsed:!r.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(B.d)(B.b))}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,a=n.height,c=t.getBoundingClientRect(),r=c.top,i=c.height;this.listEl.scrollTop+=o-r-(i-a)/2,e.classList.add("CommentItem--highlighted"),setTimeout((function(){return e.classList.remove("CommentItem--highlighted")}),2e3),e.tabIndex=-1,e.focus()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,a=t.comments,c=t.commentPattern,r=t.commentInputPosition,i=t.parent,s=i.author,l=(s=void 0===s?{isOrg:!1}:s).isOrg,u=i.commentPermission,d=i.reviewingCounts,p=i.commentCount,h=i.adminClosedComment,b=t.totals,f=t.status,C=t.order,O=t.onStatusChange,j=t.onOrderChange,g=t.targetLink,y=a.filter((function(e){return!e.isDelete})),R="censor"===u&&o,k=R?{isCommentReviewer:R,onStatusChange:O,status:f,reviewingCounts:d}:{status:f},N=v()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===c},n);return Object(m.c)("div",{className:N,ref:function(t){e.commentsElement=t},children:[Object(m.b)(je.a,Object.assign({commentCount:void 0!==p?p:b,commentClosed:h,targetLink:g,order:C,onOrderChange:j,commentPattern:c,isOrg:l,options:this.renderCommentEdit("top")},k)),"top"===r&&this.renderCommentEdit(),"bottom"===c?this.renderPatternContent(y):this.renderModalContent(y),"bottom"===r&&this.renderCommentEdit()]})}}]),n}(h.Component);Ne.propTypes={type:d.a.string,parent:d.a.object.isRequired,targetLink:d.a.node,commentNeedsReview:d.a.bool,byComment:d.a.oneOfType([d.a.number,d.a.string]),commentPattern:d.a.string,commentInputPosition:d.a.oneOf(["top","bottom"]),showPackupButton:d.a.bool,handlePackupButton:d.a.func,onPaginationClick:d.a.func,autoFocus:d.a.bool},Ne.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var Ie=Object(b.connect)((function(e,t){var n=t.parent,o=t.parent,a=o.type,c=o.id,r=t.status,i=t.order,s=t.byComment,l=t.commentPattern,m=e.entities,u=e.comments,d="".concat(a,"_").concat(c),p=u.parent,h=u.pagination;"reviewing"===r&&(h=u.reviewing),"reverse"===i&&"open"===r&&(h=u.reverse);var b=[],f=u.collapsed[d]||{};f.ids&&f.ids.length>0&&(b=f.ids.map((function(e){return m.comments[e]})));var v=h[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isPrevDrained,j=v.isDrained,g=v.ids,y=v.newIds,R=void 0===y?[]:y;return{isFetching:C,isPrevDrained:O,isDrained:j,totals:v.totals,comments:("bottom"!==l?g:R).map((function(e){return m.comments[e]})),collapsedInfo:f,collapsedComments:b,targetComment:m.comments[s],parent:Object.assign(Object.assign({},n),p[d])}}),{showNotification:B.g})(Ne);function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var Se=function(e){Object(i.a)(n,e);var t=we(n);function n(e){var o;return Object(c.a)(this,n),(o=t.call(this,e)).load=o.load.bind(Object(M.a)(o)),o.addComment=e.authRequired(o.addComment.bind(Object(M.a)(o)),void 0,B.b),o}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(C.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.type,c=o.id,r=n.commentId,i=n.dispatch,s=[a,c,e,t.id,r];return i(C.a.apply(void 0,s))}},{key:"render",value:function(){var e,t,n,o=this.props,a=o.onItemLike,c=o.onItemDelete,r=o.onItemFeature,i=o.onItemApprove,s=o.onItemCollapse,l=o.onItemDislike,u=o.onNavBack,d=o.canOperateItem,p=o.isFetching,h=o.comments,b=o.commentNeedsReview,f=o.openComment.collapsed,v=o.parent,C=o.parent.canComment,O=(C=void 0===C?{status:!0}:C).status,j=C.reason,g=o.commentPattern,y=o.commentId,R=o.currentUser;return Boolean(R&&h.find((function(e){return e.author&&e.author.member.urlToken===R.urlToken})))&&(t=(e=h.filter((function(e){return e.author&&e.author.member.urlToken!==R.urlToken})))[e.length-1]),p&&!h.length?n=Object(m.b)(N.a,{className:"CommentItem",small:!0}):h.length&&(n=h.map((function(e,t){return Object(m.b)(Ce,{isConversation:!0,commentNeedsReview:b,canOperate:d,parent:v,comment:e,onLike:a,onDelete:c,onFeature:r,onApprove:i,onCollapse:s,onDislike:l,collapsedShown:f},t)}))),"bottom"===g?Object(m.b)(U.b,{size:"fullPage",onClose:u,children:Object(m.c)("div",{className:"Comments",children:[Object(m.b)(je.a,{isConversation:!0,commentPattern:g}),Object(m.b)("div",{className:"CommentList",children:n})]})}):Object(m.c)("div",{className:"Comments",children:[Object(m.b)(je.a,{isConversation:!0,onNavBack:u}),Object(m.b)("div",{className:"CommentList",children:n}),t&&(O?Object(m.b)(Q,{id:y,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:b,onSubmit:this.addComment}):Object(m.b)("div",{className:"Comments-disabledText",children:j}))]})}}]),n}(h.Component);Se.propTypes={commentId:d.a.number.isRequired,type:d.a.string,parent:d.a.object.isRequired,commentNeedsReview:d.a.bool};var Pe=Object(p.compose)(G.a,Object(b.connect)((function(e,t){var n=t.commentId,o=e.entities.comments,a=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map((function(e){return o[e]})),openComment:o[n]}})))(Se),Ee=n(108),Be=n(148),Te=["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission","currentUser"];function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var Le=function(e){Object(i.a)(n,e);var t=xe(n);function n(e){var o;Object(c.a)(this,n),(o=t.call(this,e)).state={openedCommentId:null,status:"open",order:"normal"},o.like=function(e,t){var n=o.props,a=n.onItemLike,c=n.dispatch;a&&a(e,t),c(Object(C.j)(e))},o.collapse=function(e){var t=o.props,n=t.dispatch,a=t.parent;n(Object(C.g)(e,a.type,a.id))},o.dislike=function(e){return o.props.dispatch(Object(C.h)(e))},o.approve=function(e){var t=o.props,n=t.dispatch,a=t.parent,c=t.type;n(Object(C.b)(e,a.type||c,a.id))},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){o.props.onOrderChange&&o.props.onOrderChange(e,t),o.setState({order:e})};var a=e.parent,r=e.dispatch;return o.feature=function(e,t){return r(Object(C.i)(e,a.id,a.type,t))},o.delete=function(e){return r(Object(C.d)(e,a.type,a.id))},o.showConversation=function(e){return o.setState({openedCommentId:e})},o.showComments=function(){return o.setState({openedCommentId:null})},o}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.containerClassName,c=t.parent,r=t.commentPattern,i=t.type,s=t.parent,l=(s=void 0===s?{}:s).commentPermission,u=s.relationship,d=void 0===u?{}:u,p=s.author,h=void 0===p?{}:p,b=t.needLoadCommentPermission,f=t.currentUser,C=Object(a.default)(t,Te),O=void 0===d.isAuthor?f&&h.urlToken&&f.urlToken===h.urlToken:d.isAuthor,j="censor"===l&&!O,g="answer"===i||"article"===i,y=this.state,R=y.openedCommentId,k=y.status,N=y.order,I={commentNeedsReview:j,parent:c,type:i,canOperateItem:g,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return Object(m.c)("div",{className:v()("Comments-container",o),ref:function(t){return e.domNode=t},children:[Object(m.b)(Ie,Object.assign(Object.assign(Object.assign({},C),I),{},{commentPattern:r,className:v()(n,{"Comments--hidden":R&&"bottom"!==r}),order:N,status:k,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:b,isAuthor:O})),R&&Object(m.b)(Pe,Object.assign(Object.assign(Object.assign({},C),I),{},{commentPattern:r,commentId:R,onNavBack:this.showComments}))]})}}]),n}(h.Component);Le.propTypes={type:d.a.string.isRequired,parent:d.a.object.isRequired,onOrderChange:d.a.func,onItemLike:d.a.func,isAuthor:d.a.bool,onMount:d.a.func},Le.defaultProps={type:"answer"};t.default=Object(p.compose)(Be.a,Object(b.connect)(),Object(Ee.a)(null))(Le)}}]);
//# sourceMappingURL=column.comments-modals.6d14b7c1c443622ff62c.js.map